repeat task.wait() until game:IsLoaded()
task.wait(2)
local request = (syn and syn.request) or request or http_request or (fluxus and fluxus.request) or (http and http.request) or (Krnl and Krnl.request) or (http_request) or function(args)
    local success, result = pcall(function()
        return game:HttpGet(args.Url)
    end)
    if success then
        return {Body = result, StatusCode = 200}
    else
        return nil
    end
end
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local isMobile = UserInputService.TouchEnabled
repeat task.wait() until game:IsLoaded() and workspace.CurrentCamera
local viewport = workspace.CurrentCamera.ViewportSize
local scaleFactor = isMobile and math.min(viewport.X / 680, viewport.Y / 420) * 0.6 or 1
local State = {
    url = "https://web-production-96fee.up.railway.app/latest",
    last_job = "",
    successfully_joined = false,
    autojoiner_enabled = false,
    minimum_ms = 0,
    max_players = nil,
    brainrot_notify_enabled = false,
    brainrot_esp_enabled = false,
    ignoreList = {},
    scanMutex = false,
    lastNotifiedPet = {name = "", genText = "", mutation = ""},
    currentHighestPet = {name = "", genText = "", mutation = ""},
    notifyHideTimer = nil,
    loggedJobs = {},
    custom_fov = 70,
    currentHighlight = nil,
    currentESPOverhead = nil,
    currentCustomESP = nil,
    overheadCache = {},
    presenceUrl = "https://stealabrainrot-production.up.railway.app/presence",
    cacheUpdateInterval = 1,
    lastCacheUpdate = 0,
    currentLayoutOrder = 999999,
    spamJoinerEnabled = false,
    spamJoinerCurrentDrop = nil,
    joiningHideTimer = nil,
    lastNotifiedJob = "",
    join_notify_enabled = true,
    minimized = false,
    settingsOpen = false,
    loop_timeout = 0,
    espUpdateInterval = 0.3,
     loopTimers = {},
     lastESPUpdate = 0,
    ui_keybind = "T",
    keybindDebounce = false,
    keybindCooldown = 0.3,
    isAnimating = false,

    lastJoinNotifyTime = 0
}
local UI = {
    optionButtons = {}
}
-- Compatibility wrapper functions
local hasFileSystem = pcall(function() return isfile and readfile and writefile end)
local function safeReadFile(path)
    if not hasFileSystem then return nil end
    local success, result = pcall(function() return readfile(path) end)
    return success and result or nil
end
local function safeWriteFile(path, content)
    if not hasFileSystem then return false end
    return pcall(function() writefile(path, content) return true end)
end
local function safeIsFile(path)
    if not hasFileSystem then return false end
    local success, result = pcall(function() return isfile(path) end)
    return success and result or false
end
local function safeGetConnections(signal)
    local success, connections = pcall(function() return getconnections(signal) end)
    return success and connections or {}
end
local Tweens = {
    fast = TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
    smooth = TweenInfo.new(0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
    switch = TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
    bounce = TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out),
    filterOpen = TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out),
    filterClose = TweenInfo.new(0.35, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
}
local SettingUpdaters = {}
do
    pcall(function() if safeIsFile("cloudy_min_ms.txt") then local v = tonumber(safeReadFile("cloudy_min_ms.txt")) if v and v >= 0 then State.minimum_ms = v end end end)
    pcall(function() if isfile("cloudy_loop_timeout.txt") then local v = tonumber(readfile("cloudy_loop_timeout.txt")) if v and v >= 0 then State.loop_timeout = v end end end)
    pcall(function() if isfile("cloudy_min_players.txt") then local s = readfile("cloudy_min_players.txt") if s == "no selected" then State.max_players = nil else local v = tonumber(s) if v and v >= 1 and v <= 7 then State.max_players = v end end end end)
    pcall(function() if isfile("cloudy_join_notify.txt") then State.join_notify_enabled = readfile("cloudy_join_notify.txt") == "true" end end)
    pcall(function()
    if isfile("cloudy_ignore_list.json") then
        local success, decoded = pcall(function() return HttpService:JSONDecode(readfile("cloudy_ignore_list.json")) end)
        if success and typeof(decoded) == "table" then
            State.ignoreList = decoded
        end
    end
end)
    pcall(function() if isfile("cloudy_brainrot_notify.txt") then State.brainrot_notify_enabled = readfile("cloudy_brainrot_notify.txt") == "true" end end)
    pcall(function() if isfile("cloudy_ui_keybind.txt") then State.ui_keybind = readfile("cloudy_ui_keybind.txt") end end)
    pcall(function() if isfile("cloudy_brainrot_esp.txt") then State.brainrot_esp_enabled = readfile("cloudy_brainrot_esp.txt") == "true" end end)
    pcall(function() if isfile("cloudy_custom_fov.txt") then local v = tonumber(readfile("cloudy_custom_fov.txt")) if v and v >= 70 and v <= 120 then State.custom_fov = v end end end)
    pcall(function() if isfile("cloudy_spam_joiner.txt") then State.spamJoinerEnabled = readfile("cloudy_spam_joiner.txt") == "true" end end)
    pcall(function() if isfile("cloudy_join_notify.txt") then State.join_notify_enabled = readfile("cloudy_join_notify.txt") == "true" end end)
    pcall(function() if isfile("cloudy_brainrot_notify.txt") then State.brainrot_notify_enabled = readfile("cloudy_brainrot_notify.txt") == "true" end end)
end
local function saveIgnoreList() pcall(function() writefile("cloudy_ignore_list.json", HttpService:JSONEncode(State.ignoreList)) end) end
local function cleanJobId(j) return j and j:gsub("[^%w%-]", "") or "" end
UI.ScreenGui = Instance.new("ScreenGui")
UI.ScreenGui.Name = "CloudyHub"
UI.ScreenGui.ResetOnSpawn = false
UI.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
UI.ScreenGui.Parent = CoreGui
UI.Main = Instance.new("Frame")
UI.Main.Name = "Main"
UI.Main.Size = UDim2.new(0, 680 * scaleFactor, 0, 420 * scaleFactor)
UI.Main.Position = UDim2.new(0.5, -340 * scaleFactor, 0.5, -210 * scaleFactor)
UI.Main.BackgroundColor3 = Color3.fromRGB(12, 12, 16)
UI.Main.BorderSizePixel = 0
UI.Main.Parent = UI.ScreenGui
Instance.new("UICorner", UI.Main).CornerRadius = UDim.new(0, 12 * scaleFactor)
local mainStroke = Instance.new("UIStroke")
mainStroke.Color = Color3.fromRGB(200, 200, 200)
mainStroke.Thickness = 2 * scaleFactor
mainStroke.Parent = UI.Main
local borderGradient = Instance.new("UIGradient")
borderGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 80, 90)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 200, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 90))
}
borderGradient.Parent = mainStroke
task.spawn(function()
    while UI.Main.Parent do
        local t = TweenService:Create(borderGradient, TweenInfo.new(2.5, Enum.EasingStyle.Linear), {Rotation = 360})
        t:Play() t.Completed:Wait() borderGradient.Rotation = 0
    end
end)
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 46 * scaleFactor)
header.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
header.BorderSizePixel = 0
header.Parent = UI.Main
Instance.new("UICorner", header).CornerRadius = UDim.new(0, 12 * scaleFactor)
local headerFix = Instance.new("Frame")
headerFix.Size = UDim2.new(1, 0, 0, 14 * scaleFactor)
headerFix.Position = UDim2.new(0, 0, 1, -14 * scaleFactor)
headerFix.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
headerFix.BorderSizePixel = 0
headerFix.Parent = header
UI.StatusDot = Instance.new("Frame")
UI.StatusDot.Size = UDim2.new(0, 14 * scaleFactor, 0, 14 * scaleFactor)
UI.StatusDot.Position = UDim2.new(0, 16 * scaleFactor, 0.5, -7 * scaleFactor)
UI.StatusDot.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
UI.StatusDot.BorderSizePixel = 0
UI.StatusDot.Parent = header
Instance.new("UICorner", UI.StatusDot).CornerRadius = UDim.new(1, 0)
local title = Instance.new("TextLabel")
title.Size = UDim2.new(0, 100 * scaleFactor, 1, 0)
title.Position = UDim2.new(0, 38 * scaleFactor, 0, 0)
title.BackgroundTransparency = 1
title.Text = "CLOUDY"
title.TextColor3 = Color3.fromRGB(240, 240, 250)
title.Font = Enum.Font.GothamBlack
title.TextSize = 20 * scaleFactor
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = header
local titleGradient = Instance.new("UIGradient")
titleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 120)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(240, 240, 250))
}
titleGradient.Parent = title
task.spawn(function()
    while title.Parent do
        titleGradient.Offset = Vector2.new(-1, 0)
        local t = TweenService:Create(titleGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {Offset = Vector2.new(1, 0)})
        t:Play() t.Completed:Wait()
    end
end)
local discord = Instance.new("TextLabel")
discord.Size = UDim2.new(0, 180 * scaleFactor, 1, 0)
discord.Position = UDim2.new(0, 142 * scaleFactor, 0, 0)
discord.BackgroundTransparency = 1
discord.Text = "discord.gg/pvHh3d3pQZ"
discord.TextColor3 = Color3.fromRGB(120, 120, 140)
discord.Font = Enum.Font.GothamBold
discord.TextSize = 12 * scaleFactor
discord.TextXAlignment = Enum.TextXAlignment.Left
discord.Parent = header
local discordGradient = Instance.new("UIGradient")
discordGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(120, 120, 140)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(120, 120, 140)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 200, 220)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(120, 120, 140)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(120, 120, 140))
}
discordGradient.Parent = discord
task.spawn(function()
    while discord.Parent do
        discordGradient.Offset = Vector2.new(-1, 0)
        local t = TweenService:Create(discordGradient, TweenInfo.new(2.5, Enum.EasingStyle.Linear), {Offset = Vector2.new(1, 0)})
        t:Play() t.Completed:Wait()
    end
end)
local autoJoinContainer = Instance.new("Frame")
autoJoinContainer.Size = UDim2.new(0, 130 * scaleFactor, 0, 30 * scaleFactor)
autoJoinContainer.Position = UDim2.new(1, -265 * scaleFactor, 0.5, -15 * scaleFactor)
autoJoinContainer.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
autoJoinContainer.BorderSizePixel = 0
autoJoinContainer.Parent = header
Instance.new("UICorner", autoJoinContainer).CornerRadius = UDim.new(0, 6 * scaleFactor)
local autoJoinLabel = Instance.new("TextLabel")
autoJoinLabel.Size = UDim2.new(0, 75 * scaleFactor, 1, 0)
autoJoinLabel.Position = UDim2.new(0, 10 * scaleFactor, 0, 0)
autoJoinLabel.BackgroundTransparency = 1
autoJoinLabel.Text = "Auto-Join"
autoJoinLabel.TextColor3 = Color3.fromRGB(180, 180, 190)
autoJoinLabel.Font = Enum.Font.GothamBold
autoJoinLabel.TextSize = 12 * scaleFactor
autoJoinLabel.TextXAlignment = Enum.TextXAlignment.Left
autoJoinLabel.Parent = autoJoinContainer
UI.Switch = Instance.new("TextButton")
UI.Switch.Size = UDim2.new(0, 42 * scaleFactor, 0, 22 * scaleFactor)
UI.Switch.Position = UDim2.new(1, -50 * scaleFactor, 0.5, -11 * scaleFactor)
UI.Switch.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
UI.Switch.BorderSizePixel = 0
UI.Switch.Text = ""
UI.Switch.AutoButtonColor = false
UI.Switch.Parent = autoJoinContainer
Instance.new("UICorner", UI.Switch).CornerRadius = UDim.new(1, 0)
UI.SwitchDot = Instance.new("Frame")
UI.SwitchDot.Size = UDim2.new(0, 18 * scaleFactor, 0, 18 * scaleFactor)
UI.SwitchDot.Position = UDim2.new(0, 2 * scaleFactor, 0.5, -9 * scaleFactor)
UI.SwitchDot.BackgroundColor3 = Color3.fromRGB(150, 150, 160)
UI.SwitchDot.BorderSizePixel = 0
UI.SwitchDot.Parent = UI.Switch
Instance.new("UICorner", UI.SwitchDot).CornerRadius = UDim.new(1, 0)
UI.SettingsBtn = Instance.new("TextButton")
UI.SettingsBtn.Size = UDim2.new(0, 75 * scaleFactor, 0, 30 * scaleFactor)
UI.SettingsBtn.Position = UDim2.new(1, -122 * scaleFactor, 0.5, -15 * scaleFactor)
UI.SettingsBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
UI.SettingsBtn.BorderSizePixel = 0
UI.SettingsBtn.Text = "⚙ FILTER"
UI.SettingsBtn.TextColor3 = Color3.fromRGB(180, 180, 190)
UI.SettingsBtn.Font = Enum.Font.GothamBold
UI.SettingsBtn.TextSize = 12 * scaleFactor
UI.SettingsBtn.AutoButtonColor = false
UI.SettingsBtn.Parent = header
Instance.new("UICorner", UI.SettingsBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
UI.MinBtn = Instance.new("TextButton")
UI.MinBtn.Size = UDim2.new(0, 30 * scaleFactor, 0, 30 * scaleFactor)
UI.MinBtn.Position = UDim2.new(1, -35 * scaleFactor, 0.5, -15 * scaleFactor)
UI.MinBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
UI.MinBtn.BorderSizePixel = 0
UI.MinBtn.Text = "−"
UI.MinBtn.TextColor3 = Color3.fromRGB(180, 180, 190)
UI.MinBtn.Font = Enum.Font.GothamBold
UI.MinBtn.TextSize = 20 * scaleFactor
UI.MinBtn.AutoButtonColor = false
UI.MinBtn.Parent = header
Instance.new("UICorner", UI.MinBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
UI.Content = Instance.new("Frame")
UI.Content.Size = UDim2.new(1, -20 * scaleFactor, 1, -58 * scaleFactor)
UI.Content.Position = UDim2.new(0, 10 * scaleFactor, 0, 52 * scaleFactor)
UI.Content.BackgroundTransparency = 1
UI.Content.ClipsDescendants = true
UI.Content.Parent = UI.Main
local leftPanel = Instance.new("Frame")
leftPanel.Size = UDim2.new(0, 420 * scaleFactor, 1, 0)
leftPanel.BackgroundTransparency = 1
leftPanel.Parent = UI.Content
local tableHeader = Instance.new("Frame")
tableHeader.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
tableHeader.BackgroundColor3 = Color3.fromRGB(28, 28, 36)
tableHeader.BorderSizePixel = 0
tableHeader.Parent = leftPanel
Instance.new("UICorner", tableHeader).CornerRadius = UDim.new(0, 8 * scaleFactor)
local headerGradient = Instance.new("UIGradient")
headerGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(35, 35, 45)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(45, 45, 55)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(35, 35, 45))
}
headerGradient.Rotation = 90
headerGradient.Parent = tableHeader
local petHeader = Instance.new("TextLabel")
petHeader.Size = UDim2.new(0, 170 * scaleFactor, 1, 0)
petHeader.Position = UDim2.new(0, 16 * scaleFactor, 0, 0)
petHeader.BackgroundTransparency = 1
petHeader.Text = "NAME"
petHeader.TextColor3 = Color3.fromRGB(140, 140, 155)
petHeader.Font = Enum.Font.GothamBold
petHeader.TextSize = 12 * scaleFactor
petHeader.TextXAlignment = Enum.TextXAlignment.Left
petHeader.Parent = tableHeader
local moneyHeader = Instance.new("TextLabel")
moneyHeader.Size = UDim2.new(0, 90 * scaleFactor, 1, 0)
moneyHeader.Position = UDim2.new(0, 142 * scaleFactor, 0, 0)
moneyHeader.BackgroundTransparency = 1
moneyHeader.Text = "MONEY/s"
moneyHeader.TextColor3 = Color3.fromRGB(140, 140, 155)
moneyHeader.Font = Enum.Font.GothamBold
moneyHeader.TextSize = 12 * scaleFactor
moneyHeader.Parent = tableHeader
local playersHeader = Instance.new("TextLabel")
playersHeader.Size = UDim2.new(0, 70 * scaleFactor, 1, 0)
playersHeader.Position = UDim2.new(0, 228 * scaleFactor, 0, 0)
playersHeader.BackgroundTransparency = 1
playersHeader.Text = "PLAYERS"
playersHeader.TextColor3 = Color3.fromRGB(140, 140, 155)
playersHeader.Font = Enum.Font.GothamBold
playersHeader.TextSize = 12 * scaleFactor
playersHeader.Parent = tableHeader
local actionHeader = Instance.new("TextLabel")
actionHeader.Size = UDim2.new(0, 80 * scaleFactor, 1, 0)
actionHeader.Position = UDim2.new(1, -98 * scaleFactor, 0, 0)
actionHeader.BackgroundTransparency = 1
actionHeader.Text = "ACTION"
actionHeader.TextColor3 = Color3.fromRGB(140, 140, 155)
actionHeader.Font = Enum.Font.GothamBold
actionHeader.TextSize = 12 * scaleFactor
actionHeader.Parent = tableHeader
UI.LogsScroll = Instance.new("ScrollingFrame")
UI.LogsScroll.Size = UDim2.new(1, 0, 1, -40 * scaleFactor)
UI.LogsScroll.Position = UDim2.new(0, 0, 0, 38 * scaleFactor)
UI.LogsScroll.BackgroundTransparency = 1
UI.LogsScroll.BorderSizePixel = 0
UI.LogsScroll.ScrollBarThickness = 4 * scaleFactor
UI.LogsScroll.ScrollBarImageColor3 = Color3.fromRGB(80, 80, 100)
UI.LogsScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
UI.LogsScroll.Parent = leftPanel
local logsLayout = Instance.new("UIListLayout")
logsLayout.Padding = UDim.new(0, 5 * scaleFactor)
logsLayout.SortOrder = Enum.SortOrder.LayoutOrder
logsLayout.Parent = UI.LogsScroll
logsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    UI.LogsScroll.CanvasSize = UDim2.new(0, 0, 0, logsLayout.AbsoluteContentSize.Y + 6 * scaleFactor)
end)
local rightPanel = Instance.new("Frame")
rightPanel.Size = UDim2.new(0, 230 * scaleFactor, 1, 0)
rightPanel.Position = UDim2.new(0, 430 * scaleFactor, 0, 0)
rightPanel.BackgroundTransparency = 1
rightPanel.Parent = UI.Content
local ignoreLabel = Instance.new("TextLabel")
ignoreLabel.Size = UDim2.new(1, 0, 0, 24 * scaleFactor)
ignoreLabel.BackgroundTransparency = 1
ignoreLabel.Text = "IGNORE LIST"
ignoreLabel.TextColor3 = Color3.fromRGB(140, 140, 155)
ignoreLabel.Font = Enum.Font.GothamBold
ignoreLabel.TextSize = 13 * scaleFactor
ignoreLabel.TextXAlignment = Enum.TextXAlignment.Left
ignoreLabel.Parent = rightPanel
local addRow = Instance.new("Frame")
addRow.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
addRow.Position = UDim2.new(0, 0, 0, 28 * scaleFactor)
addRow.BackgroundTransparency = 1
addRow.Parent = rightPanel
local addInputBg = Instance.new("Frame")
addInputBg.Size = UDim2.new(1, -58 * scaleFactor, 1, 0)
addInputBg.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
addInputBg.BorderSizePixel = 0
addInputBg.Parent = addRow
Instance.new("UICorner", addInputBg).CornerRadius = UDim.new(0, 6 * scaleFactor)
UI.AddInput = Instance.new("TextBox")
UI.AddInput.Size = UDim2.new(1, -14 * scaleFactor, 1, 0)
UI.AddInput.Position = UDim2.new(0, 7 * scaleFactor, 0, 0)
UI.AddInput.BackgroundTransparency = 1
UI.AddInput.PlaceholderText = "Brainrot..."
UI.AddInput.PlaceholderColor3 = Color3.fromRGB(80, 80, 95)
UI.AddInput.Text = ""
UI.AddInput.TextColor3 = Color3.fromRGB(220, 220, 230)
UI.AddInput.Font = Enum.Font.GothamBold
UI.AddInput.TextSize = 13 * scaleFactor
UI.AddInput.TextXAlignment = Enum.TextXAlignment.Left
UI.AddInput.ClearTextOnFocus = false
UI.AddInput.Parent = addInputBg
UI.AddBtn = Instance.new("TextButton")
UI.AddBtn.Size = UDim2.new(0, 52 * scaleFactor, 1, 0)
UI.AddBtn.Position = UDim2.new(1, -52 * scaleFactor, 0, 0)
UI.AddBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
UI.AddBtn.BorderSizePixel = 0
UI.AddBtn.Text = "ADD"
UI.AddBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
UI.AddBtn.Font = Enum.Font.GothamBold
UI.AddBtn.TextSize = 12 * scaleFactor
UI.AddBtn.AutoButtonColor = false
UI.AddBtn.Parent = addRow
Instance.new("UICorner", UI.AddBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
UI.IgnoreScroll = Instance.new("ScrollingFrame")
UI.IgnoreScroll.Size = UDim2.new(1, 0, 0, 130 * scaleFactor)
UI.IgnoreScroll.Position = UDim2.new(0, 0, 0, 68 * scaleFactor)
UI.IgnoreScroll.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
UI.IgnoreScroll.BorderSizePixel = 0
UI.IgnoreScroll.ScrollBarThickness = 3 * scaleFactor
UI.IgnoreScroll.ScrollBarImageColor3 = Color3.fromRGB(70, 70, 85)
UI.IgnoreScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
UI.IgnoreScroll.Parent = rightPanel
Instance.new("UICorner", UI.IgnoreScroll).CornerRadius = UDim.new(0, 6 * scaleFactor)
local ignoreLayout = Instance.new("UIListLayout")
ignoreLayout.Padding = UDim.new(0, 3 * scaleFactor)
ignoreLayout.Parent = UI.IgnoreScroll
local ignorePadding = Instance.new("UIPadding")
ignorePadding.PaddingTop = UDim.new(0, 5 * scaleFactor)
ignorePadding.PaddingLeft = UDim.new(0, 5 * scaleFactor)
ignorePadding.PaddingRight = UDim.new(0, 5 * scaleFactor)
ignorePadding.PaddingBottom = UDim.new(0, 5 * scaleFactor)
ignorePadding.Parent = UI.IgnoreScroll
ignoreLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    UI.IgnoreScroll.CanvasSize = UDim2.new(0, 0, 0, ignoreLayout.AbsoluteContentSize.Y + 10 * scaleFactor)
end)
local BrainrotNames = {
    "Los Matteos",
    "67",
    "Los 67",
    "Esok Sekolah",
    "Swag Soda",
    "Tictac Sahur",
    "Garama and Madundung",
    "Ketupat Kepat",
    "Spaghetti Tualetti",
    "Capitano Moby",
    "Burguro And Fryuro",
    "Los Chicleteiras",
    "La Grande Combinasion",
    "Tang Tang Keletang",
    "Pot Hotspot",
    "Noo my examine",
    "Graipuss Medussi",
    "To to to Sahur",
    "Job Job Job Sahur",
    "Tung Tung Tung Sahur",
    "Los Tralaleritos",
    "La Vacca Saturno Saturnita",
    "Torrtugini Dragonfrutini",
    "Nuclearo Dinossauro",
    "Money Money Puggy",
    "Dragon Cannelloni",
    "Ketchuru and Musturu",
    "La Secret Combinasion",
    "Festive 67",
    "Swaggy Bros",
    "Gingerat Gerat",
    "Ice Dragon",
    "Reinito Sleighito",
    "Dragon Gingerini",
    "La Ginger Sekolah",
    "Los Spyderinis",
    "Las Tralaleritas",
    "Fragrama and Chocrama",
    "Fragola La La La ",
    "Frio Ninja",
    "Los Orcalitos",
    "Los Puggies",
    "Los Planitos",
    "Los Nooo My Hotspotsitos",
    "Los Hotspotsitos",
    "Los Bros",
    "Los Candies",
    "Los 25",
    "Los Bombinitos",
    "Los Spooky Combinasionas",
    "Eviledon",
    "Elefanto Frigo",
    "Los Krakeritos",
    "Los Jobcitos",
    "Los Gattitos",
    "Los Crocodillitos",
    "Los Chihuaninis",
    "Chipso and Queso",
    "Chillin Chili",
    "Las Sis",
    "Las Cappuchinas",
    "La Taco Combinasion",
    "La Sahur Combinasion",
    "La Karkerkar Combinasion",
    "La Extinct Grande",
    "La Casa Boo",
    "Burrito Bandito",
    "Horegini Boom",
    "Ho Ho Ho Sahur",
    "Headless Horseman",
    "1x1x1x1",
    "Blackhole Goat",
    "Jack Jack Jack",
    "La Supreme Combinasion",
    "Cuadramat and Pakrahmatmamat",
    "Los Tipi Tacos",
    "Chicleteira Bicicleteira",
    "Mieteteira Bicicleteira",
  
}
local moneyLabel = Instance.new("TextLabel")
moneyLabel.Size = UDim2.new(1, 0, 0, 22 * scaleFactor)
moneyLabel.Position = UDim2.new(0, 0, 0, 206 * scaleFactor)
moneyLabel.BackgroundTransparency = 1
moneyLabel.Text = "MIN MONEY (M/S)"
moneyLabel.TextColor3 = Color3.fromRGB(140, 140, 155)
moneyLabel.Font = Enum.Font.GothamBold
moneyLabel.TextSize = 13 * scaleFactor
moneyLabel.TextXAlignment = Enum.TextXAlignment.Left
moneyLabel.Parent = rightPanel
local moneyInputBg = Instance.new("Frame")
moneyInputBg.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
moneyInputBg.Position = UDim2.new(0, 0, 0, 230 * scaleFactor)
moneyInputBg.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
moneyInputBg.BorderSizePixel = 0
moneyInputBg.Parent = rightPanel
Instance.new("UICorner", moneyInputBg).CornerRadius = UDim.new(0, 6 * scaleFactor)
UI.MoneyInput = Instance.new("TextBox")
UI.MoneyInput.Size = UDim2.new(1, -14 * scaleFactor, 1, 0)
UI.MoneyInput.Position = UDim2.new(0, 7 * scaleFactor, 0, 0)
UI.MoneyInput.BackgroundTransparency = 1
UI.MoneyInput.PlaceholderText = "0"
UI.MoneyInput.PlaceholderColor3 = Color3.fromRGB(80, 80, 95)
UI.MoneyInput.Text = State.minimum_ms > 0 and tostring(State.minimum_ms) or ""
UI.MoneyInput.TextColor3 = Color3.fromRGB(220, 220, 230)
UI.MoneyInput.Font = Enum.Font.GothamBold
UI.MoneyInput.TextSize = 14 * scaleFactor
UI.MoneyInput.TextXAlignment = Enum.TextXAlignment.Left
UI.MoneyInput.ClearTextOnFocus = false
UI.MoneyInput.Parent = moneyInputBg
local maxLabel = Instance.new("TextLabel")
maxLabel.Size = UDim2.new(1, 0, 0, 22 * scaleFactor)
maxLabel.Position = UDim2.new(0, 0, 0, 272 * scaleFactor)
maxLabel.BackgroundTransparency = 1
maxLabel.Text = "MAX PLAYERS"
maxLabel.TextColor3 = Color3.fromRGB(140, 140, 155)
maxLabel.Font = Enum.Font.GothamBold
maxLabel.TextSize = 13 * scaleFactor
maxLabel.TextXAlignment = Enum.TextXAlignment.Left
maxLabel.Parent = rightPanel
UI.MaxBtn = Instance.new("TextButton")
UI.MaxBtn.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
UI.MaxBtn.Position = UDim2.new(0, 0, 0, 296 * scaleFactor)
UI.MaxBtn.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
UI.MaxBtn.BorderSizePixel = 0
UI.MaxBtn.Text = State.max_players and tostring(State.max_players) or "Any"
UI.MaxBtn.TextColor3 = Color3.fromRGB(220, 220, 230)
UI.MaxBtn.Font = Enum.Font.GothamBold
UI.MaxBtn.TextSize = 14 * scaleFactor
UI.MaxBtn.TextXAlignment = Enum.TextXAlignment.Left
UI.MaxBtn.AutoButtonColor = false
UI.MaxBtn.Parent = rightPanel
Instance.new("UICorner", UI.MaxBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
local maxPadding = Instance.new("UIPadding")
maxPadding.PaddingLeft = UDim.new(0, 10 * scaleFactor)
maxPadding.Parent = UI.MaxBtn
local maxStroke = Instance.new("UIStroke")
maxStroke.Color = Color3.fromRGB(50, 50, 60)
maxStroke.Thickness = 1 * scaleFactor
maxStroke.Parent = UI.MaxBtn
local maxArrow = Instance.new("TextLabel")
maxArrow.Size = UDim2.new(0, 26 * scaleFactor, 1, 0)
maxArrow.Position = UDim2.new(1, -30 * scaleFactor, 0, 0)
maxArrow.BackgroundTransparency = 1
maxArrow.Text = "▼"
maxArrow.TextColor3 = Color3.fromRGB(100, 100, 115)
maxArrow.Font = Enum.Font.GothamBold
maxArrow.TextSize = 17 * scaleFactor
maxArrow.Parent = UI.MaxBtn
local options = {"Any", "1", "2", "3", "4", "5", "6", "7"}

if not isMobile then
    local buttonHeight = 28 * scaleFactor
    local buttonSpacing = 3 * scaleFactor
    local maxVisibleButtons = 1
    local visibleHeight = (maxVisibleButtons * buttonHeight) + 8 * scaleFactor
    UI.MaxPlayersDropdown = Instance.new("ScrollingFrame")
    UI.MaxPlayersDropdown.Size = UDim2.new(0, 230 * scaleFactor, 0, 0)
    UI.MaxPlayersDropdown.Position = UDim2.new(0, 0, 0, 330 * scaleFactor)
    UI.MaxPlayersDropdown.BackgroundTransparency = 1
    UI.MaxPlayersDropdown.BorderSizePixel = 0
    UI.MaxPlayersDropdown.Visible = false
    UI.MaxPlayersDropdown.ClipsDescendants = true
    UI.MaxPlayersDropdown.ScrollBarThickness = 4 * scaleFactor
    UI.MaxPlayersDropdown.ScrollBarImageColor3 = Color3.fromRGB(70, 70, 85)
    UI.MaxPlayersDropdown.CanvasSize = UDim2.new(0, 0, 0, 0)
    UI.MaxPlayersDropdown.ZIndex = 100
    UI.MaxPlayersDropdown.ScrollingDirection = Enum.ScrollingDirection.Y
    UI.MaxPlayersDropdown.VerticalScrollBarInset = Enum.ScrollBarInset.ScrollBar
    UI.MaxPlayersDropdown.ScrollingEnabled = true
    UI.MaxPlayersDropdown.ElasticBehavior = Enum.ElasticBehavior.Never
    UI.MaxPlayersDropdown.Parent = rightPanel
    local dropdownLayout = Instance.new("UIListLayout")
    dropdownLayout.FillDirection = Enum.FillDirection.Vertical
    dropdownLayout.Padding = UDim.new(0, buttonSpacing)
    dropdownLayout.SortOrder = Enum.SortOrder.LayoutOrder
    dropdownLayout.Parent = UI.MaxPlayersDropdown
    local dropdownPadding = Instance.new("UIPadding")
    dropdownPadding.PaddingTop = UDim.new(0, 4 * scaleFactor)
    dropdownPadding.PaddingBottom = UDim.new(0, 4 * scaleFactor)
    dropdownPadding.PaddingLeft = UDim.new(0, 5 * scaleFactor)
    dropdownPadding.PaddingRight = UDim.new(0, 5 * scaleFactor)
    dropdownPadding.Parent = UI.MaxPlayersDropdown
    local function updateVisibleOptions()
        local currentValue = State.max_players and tostring(State.max_players) or "Any"
        local visibleCount = 0
        for _, optBtn in pairs(UI.optionButtons) do
            local optValue = optBtn:GetAttribute("OptionValue")
            if optValue == currentValue then
                optBtn.Visible = false
            else
                optBtn.Visible = true
                visibleCount = visibleCount + 1
            end
        end
        local totalHeight = (visibleCount * buttonHeight) + ((visibleCount - 1) * buttonSpacing) + 8 * scaleFactor
        UI.MaxPlayersDropdown.CanvasSize = UDim2.new(0, 0, 0, totalHeight)
    end
    local currentScrollIndex = 0
    local isScrolling = false
    UI.MaxPlayersDropdown.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseWheel then
            if isScrolling then return end
            isScrolling = true
          
            local scrollDelta = -input.Position.Z
          
            if scrollDelta > 0 then
                currentScrollIndex = math.min(currentScrollIndex + 1, #UI.optionButtons - 1)
            else
                currentScrollIndex = math.max(currentScrollIndex - 1, 0)
            end
          
            local targetY = currentScrollIndex * (buttonHeight + buttonSpacing)
          
            TweenService:Create(UI.MaxPlayersDropdown, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                CanvasPosition = Vector2.new(0, targetY)
            }):Play()
          
            task.delay(0.2, function()
                isScrolling = false
            end)
        end
    end)
    for i, opt in ipairs(options) do
        local optBtn = Instance.new("TextButton")
        optBtn.Size = UDim2.new(1, -8 * scaleFactor, 0, buttonHeight)
        optBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
        optBtn.BorderSizePixel = 0
        optBtn.Text = opt
        optBtn.TextColor3 = Color3.fromRGB(220, 220, 230)
        optBtn.Font = Enum.Font.GothamBold
        optBtn.TextSize = 13 * scaleFactor
        optBtn.AutoButtonColor = false
        optBtn.ZIndex = 101
        optBtn.LayoutOrder = i
        optBtn:SetAttribute("OptionValue", opt)
        optBtn.Parent = UI.MaxPlayersDropdown
        Instance.new("UICorner", optBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
        optBtn.MouseEnter:Connect(function()
            TweenService:Create(optBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
        end)
        optBtn.MouseLeave:Connect(function()
            TweenService:Create(optBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
        end)
        optBtn.MouseButton1Click:Connect(function()
            if opt == "Any" then
                State.max_players = nil
            else
                State.max_players = tonumber(opt)
            end
            pcall(function() writefile("cloudy_min_players.txt", opt == "Any" and "no selected" or opt) end)
            UI.MaxBtn.Text = opt
            updateVisibleOptions()
            currentScrollIndex = 0
            TweenService:Create(maxArrow, Tweens.fast, {Rotation = 0}):Play()
            TweenService:Create(UI.MaxPlayersDropdown, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {Size = UDim2.new(0, 230 * scaleFactor, 0, 0)}):Play()
            task.wait(0.2)
            UI.MaxPlayersDropdown.Visible = false
            State.minPlayersDropdownVisible = false
        end)
        table.insert(UI.optionButtons, optBtn)
    end
    updateVisibleOptions()
    UI.MaxBtn.MouseEnter:Connect(function()
        TweenService:Create(maxStroke, Tweens.fast, {Color = Color3.fromRGB(80, 80, 100)}):Play()
    end)
    UI.MaxBtn.MouseLeave:Connect(function()
        TweenService:Create(maxStroke, Tweens.fast, {Color = Color3.fromRGB(50, 50, 60)}):Play()
    end)
    UI.MaxBtn.MouseButton1Click:Connect(function()
        State.minPlayersDropdownVisible = not State.minPlayersDropdownVisible
        if State.minPlayersDropdownVisible then
            updateVisibleOptions()
            UI.MaxPlayersDropdown.Visible = true
            UI.MaxPlayersDropdown.Size = UDim2.new(0, 230 * scaleFactor, 0, 0)
            UI.MaxPlayersDropdown.CanvasPosition = Vector2.new(0, 0)
            currentScrollIndex = 0
            TweenService:Create(maxArrow, Tweens.fast, {Rotation = 180}):Play()
            TweenService:Create(UI.MaxPlayersDropdown, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), {Size = UDim2.new(0, 230 * scaleFactor, 0, visibleHeight)}):Play()
        else
            TweenService:Create(maxArrow, Tweens.fast, {Rotation = 0}):Play()
            TweenService:Create(UI.MaxPlayersDropdown, TweenInfo.new(0.2, Enum.EasingStyle.Quint, Enum.EasingDirection.In), {Size = UDim2.new(0, 230 * scaleFactor, 0, 0)}):Play()
            task.wait(0.2)
            UI.MaxPlayersDropdown.Visible = false
        end
    end)
else
    maxArrow:Destroy()
    local currentIndex = State.max_players == nil and 1 or (State.max_players + 1)
    UI.MaxBtn.MouseButton1Click:Connect(function()
        currentIndex = (currentIndex % #options) + 1
        local opt = options[currentIndex]
        UI.MaxBtn.Text = opt
        if opt == "Any" then
            State.max_players = nil
        else
            State.max_players = tonumber(opt)
        end
        pcall(function() writefile("cloudy_min_players.txt", opt == "Any" and "no selected" or opt) end)
    end)
end
UI.MinBar = Instance.new("Frame")
UI.MinBar.Size = UDim2.new(0, (isMobile and 200 or 240) * scaleFactor, 0, 38 * scaleFactor)
UI.MinBar.Position = UDim2.new(0.5, (isMobile and -100 or -100) * scaleFactor, 0, 10 * scaleFactor)
UI.MinBar.BackgroundColor3 = Color3.fromRGB(12, 12, 16)
UI.MinBar.BorderSizePixel = 0
UI.MinBar.Visible = false
UI.MinBar.Parent = UI.ScreenGui
Instance.new("UICorner", UI.MinBar).CornerRadius = UDim.new(0, 8 * scaleFactor)
local minStroke = Instance.new("UIStroke")
minStroke.Color = Color3.fromRGB(200, 200, 200)
minStroke.Thickness = 2 * scaleFactor
minStroke.Parent = UI.MinBar
local minBorderGradient = Instance.new("UIGradient")
minBorderGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(80, 80, 90)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(200, 200, 220)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 90))
}
minBorderGradient.Parent = minStroke
task.spawn(function()
    while UI.MinBar.Parent do
        local t = TweenService:Create(minBorderGradient, TweenInfo.new(2.5, Enum.EasingStyle.Linear), {Rotation = 360})
        t:Play() t.Completed:Wait() minBorderGradient.Rotation = 0
    end
end)
UI.MinDot = Instance.new("Frame")
UI.MinDot.Size = UDim2.new(0, 8 * scaleFactor, 0, 8 * scaleFactor)
UI.MinDot.Position = UDim2.new(0, 12 * scaleFactor, 0.5, -4 * scaleFactor)
UI.MinDot.BackgroundColor3 = Color3.fromRGB(70, 70, 80)
UI.MinDot.BorderSizePixel = 0
UI.MinDot.Parent = UI.MinBar
Instance.new("UICorner", UI.MinDot).CornerRadius = UDim.new(1, 0)
local minTitle = Instance.new("TextLabel")
minTitle.Size = UDim2.new(1, -60 * scaleFactor, 1, 0)
minTitle.Position = UDim2.new(0, 29 * scaleFactor, 0, -0.9)
minTitle.BackgroundTransparency = 1
minTitle.Text = "CLOUDY"
minTitle.TextColor3 = Color3.fromRGB(220, 220, 230)
minTitle.Font = Enum.Font.GothamBold
minTitle.TextSize = 16 * scaleFactor
minTitle.TextXAlignment = Enum.TextXAlignment.Left
minTitle.Parent = UI.MinBar
local minTitleGradient = Instance.new("UIGradient")
minTitleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 120)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(240, 240, 250))
}
minTitleGradient.Parent = minTitle
task.spawn(function()
    while minTitle.Parent do
        minTitleGradient.Offset = Vector2.new(-1, 0)
        local t = TweenService:Create(minTitleGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {Offset = Vector2.new(1, 0)})
        t:Play() t.Completed:Wait()
    end
end)
local minVersion = Instance.new("TextLabel")
minVersion.Size = UDim2.new(0, 80 * scaleFactor, 1, 0)
minVersion.Position = UDim2.new(0, 89 * scaleFactor, 0, 1)
minVersion.BackgroundTransparency = 1
minVersion.Text = "vBeta"
minVersion.TextColor3 = Color3.fromRGB(220, 220, 230)
minVersion.Font = Enum.Font.GothamBold
minVersion.TextSize = 12 * scaleFactor
minVersion.TextXAlignment = Enum.TextXAlignment.Left
minVersion.Parent = UI.MinBar
local minVersionGradient = Instance.new("UIGradient")
minVersionGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 120)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(240, 240, 250))
}
minVersionGradient.Parent = minVersion
task.spawn(function()
    while minVersion.Parent do
        minVersionGradient.Offset = Vector2.new(-1, 0)
        local t = TweenService:Create(minVersionGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {Offset = Vector2.new(1, 0)})
        t:Play() t.Completed:Wait()
    end
end)

if isMobile then
    local minArrow = Instance.new("TextLabel")
    minArrow.Size = UDim2.new(0, 20 * scaleFactor, 1, 0)
    minArrow.Position = UDim2.new(1, -25 * scaleFactor, 0, 0)
    minArrow.BackgroundTransparency = 1
    minArrow.Text = "▼"
    minArrow.TextColor3 = Color3.fromRGB(255, 255, 255)
    minArrow.Font = Enum.Font.GothamBold
    minArrow.TextSize = 20 * scaleFactor
    minArrow.Parent = UI.MinBar
    minVersion.Position = UDim2.new(0, 83 * scaleFactor, 0, 1)
    -- Adjust beta text position for mobile to be closer
end

if not isMobile then
UI.ExpandBtn = Instance.new("TextButton")
UI.ExpandBtn.Size = UDim2.new(0, 26 * scaleFactor, 0, 24 * scaleFactor)
UI.ExpandBtn.Position = UDim2.new(1, -34 * scaleFactor, 0.5, -12 * scaleFactor)
UI.ExpandBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
UI.ExpandBtn.BorderSizePixel = 0
UI.ExpandBtn.Text = "+"
UI.ExpandBtn.TextColor3 = Color3.fromRGB(180, 180, 190)
UI.ExpandBtn.Font = Enum.Font.GothamBold
UI.ExpandBtn.TextSize = 18 * scaleFactor
UI.ExpandBtn.AutoButtonColor = false
UI.ExpandBtn.Parent = UI.MinBar
Instance.new("UICorner", UI.ExpandBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
end
UI.SettingsPopup = Instance.new("Frame")
UI.SettingsPopup.Size = UDim2.new(0, 240 * scaleFactor, 0, 280 * scaleFactor)
UI.SettingsPopup.Position = isMobile and UDim2.new(0, 430 * scaleFactor, 0, 50 * scaleFactor) or UDim2.new(1, 10 * scaleFactor, 0, 50 * scaleFactor)
UI.SettingsPopup.BackgroundColor3 = Color3.fromRGB(12, 12, 16)
UI.SettingsPopup.BorderSizePixel = 0
UI.SettingsPopup.Visible = false
UI.SettingsPopup.Parent = UI.Main
Instance.new("UICorner", UI.SettingsPopup).CornerRadius = UDim.new(0, 10 * scaleFactor)
local popupStroke = Instance.new("UIStroke")
popupStroke.Color = Color3.fromRGB(50, 50, 65)
popupStroke.Thickness = 1 * scaleFactor
popupStroke.Parent = UI.SettingsPopup
local settingsHeader = Instance.new("Frame")
settingsHeader.Name = "SettingsHeader"
settingsHeader.Size = UDim2.new(1, 0, 0, 42 * scaleFactor)
settingsHeader.Position = UDim2.new(0, 0, 0, 0)
settingsHeader.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
settingsHeader.BorderSizePixel = 0
settingsHeader.ZIndex = 2
settingsHeader.Parent = UI.SettingsPopup
Instance.new("UICorner", settingsHeader).CornerRadius = UDim.new(0, 10 * scaleFactor)
local settingsHeaderFix = Instance.new("Frame")
settingsHeaderFix.Size = UDim2.new(1, 0, 0, 12 * scaleFactor)
settingsHeaderFix.Position = UDim2.new(0, 0, 1, -12 * scaleFactor)
settingsHeaderFix.BackgroundColor3 = Color3.fromRGB(18, 18, 24)
settingsHeaderFix.BorderSizePixel = 0
settingsHeaderFix.Parent = settingsHeader
local filtersTitle = Instance.new("TextLabel")
filtersTitle.Size = UDim2.new(0, 120 * scaleFactor, 1, 0)
filtersTitle.Position = UDim2.new(0, 12 * scaleFactor, 0, 0)
filtersTitle.BackgroundTransparency = 1
filtersTitle.Text = "FILTERS"
filtersTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
filtersTitle.Font = Enum.Font.GothamBlack
filtersTitle.TextSize = 17 * scaleFactor
filtersTitle.TextXAlignment = Enum.TextXAlignment.Left
filtersTitle.Parent = settingsHeader
local filtersTitleGradient = Instance.new("UIGradient")
filtersTitleGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.4, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(100, 100, 120)),
    ColorSequenceKeypoint.new(0.6, Color3.fromRGB(240, 240, 250)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(240, 240, 250))
}
filtersTitleGradient.Parent = filtersTitle
task.spawn(function()
    while filtersTitle.Parent do
        filtersTitleGradient.Offset = Vector2.new(-1, 0)
        local t = TweenService:Create(filtersTitleGradient, TweenInfo.new(2, Enum.EasingStyle.Linear), {Offset = Vector2.new(1, 0)})
        t:Play() t.Completed:Wait()
    end
end)
UI.DefaultBtn = Instance.new("TextButton")
UI.DefaultBtn.Size = UDim2.new(0, 70 * scaleFactor, 0, 24 * scaleFactor)
UI.DefaultBtn.Position = isMobile and UDim2.new(1, -82 * scaleFactor, 0.5, -12 * scaleFactor) or UDim2.new(1, -102 * scaleFactor, 0.5, -12 * scaleFactor)
UI.DefaultBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 55)
UI.DefaultBtn.BorderSizePixel = 0
UI.DefaultBtn.Text = "DEFAULT"
UI.DefaultBtn.TextColor3 = Color3.fromRGB(170, 170, 190)
UI.DefaultBtn.Font = Enum.Font.GothamBold
UI.DefaultBtn.TextSize = 10 * scaleFactor
UI.DefaultBtn.AutoButtonColor = false
UI.DefaultBtn.Parent = settingsHeader
Instance.new("UICorner", UI.DefaultBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
if not isMobile then
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 24 * scaleFactor, 0, 24 * scaleFactor)
    closeBtn.Position = UDim2.new(1, -30 * scaleFactor, 0.5, -12 * scaleFactor)
    closeBtn.BackgroundColor3 = Color3.fromRGB(55, 40, 40)
    closeBtn.BorderSizePixel = 0
    closeBtn.Text = "×"
    closeBtn.TextColor3 = Color3.fromRGB(255, 90, 90)
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 16 * scaleFactor
    closeBtn.AutoButtonColor = false
    closeBtn.Parent = settingsHeader
    Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
    closeBtn.MouseButton1Click:Connect(function()
        State.settingsOpen = false
        TweenService:Create(UI.SettingsPopup, Tweens.filterClose, {Position = UDim2.new(0, -10 * scaleFactor, 0, 50 * scaleFactor)}):Play()
        task.delay(0.35, function()
            if not State.settingsOpen then UI.SettingsPopup.Visible = false end
        end)
    end)
    closeBtn.MouseEnter:Connect(function()
        TweenService:Create(closeBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(75, 50, 50)}):Play()
    end)
    closeBtn.MouseLeave:Connect(function()
        TweenService:Create(closeBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(55, 40, 40)}):Play()
    end)
end
UI.DefaultBtn.MouseButton1Click:Connect(function()
    State.brainrot_notify_enabled = false
    State.brainrot_esp_enabled = false
    State.spamJoinerEnabled = false
    State.custom_fov = 70
    UI.FovInput.Text = "70"
    SettingUpdaters.espUpdate(false)
    SettingUpdaters.notifyUpdate(false)
    SettingUpdaters.spamUpdate(false)
    SettingUpdaters.joinNotifyUpdate(false)
    pcall(function() writefile("cloudy_brainrot_notify.txt", "false") end)
    pcall(function() writefile("cloudy_brainrot_esp.txt", "false") end)
    pcall(function() writefile("cloudy_spam_joiner.txt", "false") end)
    pcall(function() writefile("cloudy_custom_fov.txt", "70") end)
    if State.currentHighlight then pcall(function() State.currentHighlight:Destroy() end) State.currentHighlight = nil end
    if State.currentCustomESP then pcall(function() State.currentCustomESP:Destroy() end) State.currentCustomESP = nil end
    if game.Workspace.CurrentCamera then game.Workspace.CurrentCamera.FieldOfView = 70 end
end)
UI.DefaultBtn.MouseEnter:Connect(function()
    TweenService:Create(UI.DefaultBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(80, 80, 90)}):Play()
end)
UI.DefaultBtn.MouseLeave:Connect(function()
    TweenService:Create(UI.DefaultBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
end)
local settingsContent = Instance.new("Frame")
settingsContent.Name = "SettingsContent"
settingsContent.Size = UDim2.new(1, 0, 1, -42 * scaleFactor)
settingsContent.Position = UDim2.new(0, 0, 0, 42 * scaleFactor)
settingsContent.BackgroundColor3 = Color3.fromRGB(12, 12, 16)
settingsContent.BackgroundTransparency = 0
settingsContent.ZIndex = 1
settingsContent.Parent = UI.SettingsPopup
Instance.new("UICorner", settingsContent).CornerRadius = UDim.new(0, 10 * scaleFactor)
local contentTopFix = Instance.new("Frame")
contentTopFix.Size = UDim2.new(1, 0, 0, 12 * scaleFactor)
contentTopFix.Position = UDim2.new(0, 0, 0, 0)
contentTopFix.BackgroundColor3 = Color3.fromRGB(12, 12, 16)
contentTopFix.BorderSizePixel = 0
contentTopFix.Parent = settingsContent
local settingsLayout = Instance.new("UIListLayout")
settingsLayout.Padding = UDim.new(0, 5 * scaleFactor)
settingsLayout.Parent = settingsContent
local settingsPadding = Instance.new("UIPadding")
settingsPadding.PaddingTop = UDim.new(0, 3 * scaleFactor)
settingsPadding.PaddingLeft = UDim.new(0, 10 * scaleFactor)
settingsPadding.PaddingRight = UDim.new(0, 10 * scaleFactor)
settingsPadding.PaddingBottom = UDim.new(0, 10 * scaleFactor)
settingsPadding.Parent = settingsContent
local function createSettingSwitch(text, state, callback)
    local row = Instance.new("Frame")
    row.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
    row.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
    row.BorderSizePixel = 0
    row.Parent = settingsContent
    Instance.new("UICorner", row).CornerRadius = UDim.new(0, 6 * scaleFactor)
  
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -55 * scaleFactor, 1, 0)
    label.Position = UDim2.new(0, 12 * scaleFactor, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(200, 200, 210)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 12 * scaleFactor
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = row
  
    local switchBg = Instance.new("Frame")
    switchBg.Size = UDim2.new(0, 44 * scaleFactor, 0, 20 * scaleFactor)
    switchBg.Position = UDim2.new(1, -50 * scaleFactor, 0.5, -10 * scaleFactor)
    switchBg.BackgroundColor3 = state and Color3.fromRGB(70, 180, 100) or Color3.fromRGB(50, 50, 60)
    switchBg.BorderSizePixel = 0
    switchBg.Parent = row
    Instance.new("UICorner", switchBg).CornerRadius = UDim.new(1, 0)
  
    local dot = Instance.new("Frame")
    dot.Size = UDim2.new(0, 16 * scaleFactor, 0, 16 * scaleFactor)
    dot.Position = state and UDim2.new(1, -18 * scaleFactor, 0.5, -8 * scaleFactor) or UDim2.new(0, 2 * scaleFactor, 0.5, -8 * scaleFactor)
    dot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    dot.BorderSizePixel = 0
    dot.Parent = switchBg
    Instance.new("UICorner", dot).CornerRadius = UDim.new(1, 0)
  
    local clickArea = Instance.new("TextButton")
    clickArea.Size = UDim2.new(0, 55 * scaleFactor, 1, 0)
    clickArea.Position = UDim2.new(1, -55 * scaleFactor, 0, 0)
    clickArea.BackgroundTransparency = 1
    clickArea.Text = ""
    clickArea.Parent = row
  
    local function update(on)
        TweenService:Create(switchBg, Tweens.switch, {BackgroundColor3 = on and Color3.fromRGB(70, 180, 100) or Color3.fromRGB(50, 50, 60)}):Play()
        TweenService:Create(dot, Tweens.switch, {Position = on and UDim2.new(1, -18 * scaleFactor, 0.5, -8 * scaleFactor) or UDim2.new(0, 2 * scaleFactor, 0.5, -8 * scaleFactor)}):Play()
    end
    clickArea.MouseButton1Click:Connect(function() callback(update) end)
    return row, update
end
local _, spamUpdate = createSettingSwitch("Spam Joiner", State.spamJoinerEnabled, function(update)
    State.spamJoinerEnabled = not State.spamJoinerEnabled
    pcall(function() writefile("cloudy_spam_joiner.txt", tostring(State.spamJoinerEnabled)) end)
    update(State.spamJoinerEnabled)
end)
SettingUpdaters.spamUpdate = spamUpdate
local _, joinNotifyUpdate = createSettingSwitch("Join Notify", State.join_notify_enabled, function(update)
    State.join_notify_enabled = not State.join_notify_enabled
    pcall(function() writefile("cloudy_join_notify.txt", tostring(State.join_notify_enabled)) end)
    update(State.join_notify_enabled)
end)
SettingUpdaters.joinNotifyUpdate = joinNotifyUpdate
local timeoutRow = Instance.new("Frame")
timeoutRow.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
timeoutRow.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
timeoutRow.BorderSizePixel = 0
timeoutRow.Parent = settingsContent
Instance.new("UICorner", timeoutRow).CornerRadius = UDim.new(0, 6 * scaleFactor)
local timeoutLabel = Instance.new("TextLabel")
timeoutLabel.Size = UDim2.new(0, 120 * scaleFactor, 1, 0)
timeoutLabel.Position = UDim2.new(0, 12 * scaleFactor, 0, 0)
timeoutLabel.BackgroundTransparency = 1
timeoutLabel.Text = "LOOP TIMEOUT (s)"
timeoutLabel.TextColor3 = Color3.fromRGB(200, 200, 210)
timeoutLabel.Font = Enum.Font.GothamBold
timeoutLabel.TextSize = 12 * scaleFactor
timeoutLabel.TextXAlignment = Enum.TextXAlignment.Left
timeoutLabel.Parent = timeoutRow
local timeoutInputBg = Instance.new("Frame")
timeoutInputBg.Size = UDim2.new(0, 70 * scaleFactor, 0, 24 * scaleFactor)
timeoutInputBg.Position = UDim2.new(1, -76 * scaleFactor, 0.5, -12 * scaleFactor)
timeoutInputBg.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
timeoutInputBg.BorderSizePixel = 0
timeoutInputBg.Parent = timeoutRow
Instance.new("UICorner", timeoutInputBg).CornerRadius = UDim.new(0, 5 * scaleFactor)
UI.TimeoutInput = Instance.new("TextBox")
UI.TimeoutInput.Size = UDim2.new(1, -10 * scaleFactor, 1, 0)
UI.TimeoutInput.Position = UDim2.new(0, 5 * scaleFactor, 0, 0)
UI.TimeoutInput.BackgroundTransparency = 1
UI.TimeoutInput.PlaceholderText = "0 = Off"
UI.TimeoutInput.PlaceholderColor3 = Color3.fromRGB(80, 80, 95)
UI.TimeoutInput.Text = tostring(State.loop_timeout or 0)
UI.TimeoutInput.TextColor3 = Color3.fromRGB(220, 220, 230)
UI.TimeoutInput.Font = Enum.Font.GothamBold
UI.TimeoutInput.TextSize = 12 * scaleFactor
UI.TimeoutInput.TextXAlignment = Enum.TextXAlignment.Center
UI.TimeoutInput.ClearTextOnFocus = false
UI.TimeoutInput.Parent = timeoutInputBg
if not isMobile then
    local keybindRow = Instance.new("Frame")
    keybindRow.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
    keybindRow.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
    keybindRow.BorderSizePixel = 0
    keybindRow.Parent = settingsContent
    Instance.new("UICorner", keybindRow).CornerRadius = UDim.new(0, 6 * scaleFactor)
   
    local keybindLabel = Instance.new("TextLabel")
    keybindLabel.Size = UDim2.new(0, 100 * scaleFactor, 1, 0)
    keybindLabel.Position = UDim2.new(0, 12 * scaleFactor, 0, 0)
    keybindLabel.BackgroundTransparency = 1
    keybindLabel.Text = "UI KEYBIND"
    keybindLabel.TextColor3 = Color3.fromRGB(200, 200, 210)
    keybindLabel.Font = Enum.Font.GothamBold
    keybindLabel.TextSize = 12 * scaleFactor
    keybindLabel.TextXAlignment = Enum.TextXAlignment.Left
    keybindLabel.Parent = keybindRow
   
    local keybindInputBg = Instance.new("Frame")
    keybindInputBg.Size = UDim2.new(0, 70 * scaleFactor, 0, 24 * scaleFactor)
    keybindInputBg.Position = UDim2.new(1, -76 * scaleFactor, 0.5, -12 * scaleFactor)
    keybindInputBg.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
    keybindInputBg.BorderSizePixel = 0
    keybindInputBg.Parent = keybindRow
    Instance.new("UICorner", keybindInputBg).CornerRadius = UDim.new(0, 5 * scaleFactor)
   
    UI.KeybindInput = Instance.new("TextBox")
    UI.KeybindInput.Size = UDim2.new(1, -10 * scaleFactor, 1, 0)
    UI.KeybindInput.Position = UDim2.new(0, 5 * scaleFactor, 0, 0)
    UI.KeybindInput.BackgroundTransparency = 1
    UI.KeybindInput.PlaceholderText = "B"
    UI.KeybindInput.PlaceholderColor3 = Color3.fromRGB(80, 80, 95)
    UI.KeybindInput.Text = State.ui_keybind or "B"
    UI.KeybindInput.TextColor3 = Color3.fromRGB(220, 220, 230)
    UI.KeybindInput.Font = Enum.Font.GothamBold
    UI.KeybindInput.TextSize = 12 * scaleFactor
    UI.KeybindInput.TextXAlignment = Enum.TextXAlignment.Center
    UI.KeybindInput.ClearTextOnFocus = false
    UI.KeybindInput.Parent = keybindInputBg
   
    UI.KeybindInput.FocusLost:Connect(function()
        local input = UI.KeybindInput.Text:upper()
        if input and input ~= "" and #input == 1 then
            State.ui_keybind = input
            pcall(function() writefile("cloudy_ui_keybind.txt", input) end)
            UI.KeybindInput.Text = input
        else
            UI.KeybindInput.Text = State.ui_keybind or "T"
        end
    end)
end
local fovRow = Instance.new("Frame")
fovRow.Size = UDim2.new(1, 0, 0, 34 * scaleFactor)
fovRow.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
fovRow.BorderSizePixel = 0
fovRow.Parent = settingsContent
Instance.new("UICorner", fovRow).CornerRadius = UDim.new(0, 6 * scaleFactor)
local fovLabel = Instance.new("TextLabel")
fovLabel.Size = UDim2.new(0, 60 * scaleFactor, 1, 0)
fovLabel.Position = UDim2.new(0, 12 * scaleFactor, 0, 0)
fovLabel.BackgroundTransparency = 1
fovLabel.Text = "FOV"
fovLabel.TextColor3 = Color3.fromRGB(200, 200, 210)
fovLabel.Font = Enum.Font.GothamBold
fovLabel.TextSize = 12 * scaleFactor
fovLabel.TextXAlignment = Enum.TextXAlignment.Left
fovLabel.Parent = fovRow
local fovInputBg = Instance.new("Frame")
fovInputBg.Size = UDim2.new(0, 70 * scaleFactor, 0, 24 * scaleFactor)
fovInputBg.Position = UDim2.new(1, -76 * scaleFactor, 0.5, -12 * scaleFactor)
fovInputBg.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
fovInputBg.BorderSizePixel = 0
fovInputBg.Parent = fovRow
Instance.new("UICorner", fovInputBg).CornerRadius = UDim.new(0, 5 * scaleFactor)
UI.FovInput = Instance.new("TextBox")
UI.FovInput.Size = UDim2.new(1, -10 * scaleFactor, 1, 0)
UI.FovInput.Position = UDim2.new(0, 5 * scaleFactor, 0, 0)
UI.FovInput.BackgroundTransparency = 1
UI.FovInput.Text = tostring(State.custom_fov)
UI.FovInput.TextColor3 = Color3.fromRGB(220, 220, 230)
UI.FovInput.Font = Enum.Font.GothamBold
UI.FovInput.TextSize = 12 * scaleFactor
UI.FovInput.TextXAlignment = Enum.TextXAlignment.Center
UI.FovInput.ClearTextOnFocus = false
UI.FovInput.Parent = fovInputBg
UI.FovInput.FocusLost:Connect(function()
    local value = tonumber(UI.FovInput.Text)
    if value and value >= 70 and value <= 120 then
        State.custom_fov = value
        pcall(function() writefile("cloudy_custom_fov.txt", tostring(State.custom_fov)) end)
        game.Workspace.CurrentCamera.FieldOfView = State.custom_fov
    else
        UI.FovInput.Text = tostring(State.custom_fov)
    end
end)
do
    UI.joiningNotifyFrame = Instance.new("Frame")
    UI.joiningNotifyFrame.Name = "JoiningNotifyFrame"
    UI.joiningNotifyFrame.Size = UDim2.new(0, (isMobile and 320 or 420) * scaleFactor, 0, (isMobile and 50 or 60) * scaleFactor)
    UI.joiningNotifyFrame.Position = UDim2.new(1, 0, 0, 80 * scaleFactor)
    UI.joiningNotifyFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 25)
    UI.joiningNotifyFrame.BorderSizePixel = 0
    UI.joiningNotifyFrame.Visible = false
    UI.joiningNotifyFrame.Parent = UI.ScreenGui
    Instance.new("UICorner", UI.joiningNotifyFrame).CornerRadius = UDim.new(0, 10 * scaleFactor)
    UI.joiningStroke = Instance.new("UIStroke")
    UI.joiningStroke.Color = Color3.fromRGB(100, 255, 150)
    UI.joiningStroke.Thickness = 2 * scaleFactor
    UI.joiningStroke.Parent = UI.joiningNotifyFrame
    local joiningIcon = Instance.new("Frame")
    joiningIcon.Size = UDim2.new(0, (isMobile and 24 or 32) * scaleFactor, 0, (isMobile and 24 or 32) * scaleFactor)
    joiningIcon.Position = UDim2.new(0, (isMobile and 8 or 12) * scaleFactor, 0.5, (isMobile and -12 or -16) * scaleFactor)
    joiningIcon.BackgroundColor3 = Color3.fromRGB(60, 180, 90)
    joiningIcon.BorderSizePixel = 0
    joiningIcon.Parent = UI.joiningNotifyFrame
    Instance.new("UICorner", joiningIcon).CornerRadius = UDim.new(1, 0)
    local joiningIconText = Instance.new("TextLabel")
    joiningIconText.Size = UDim2.new(1, 0, 1, 0)
    joiningIconText.BackgroundTransparency = 1
    joiningIconText.Text = "→"
    joiningIconText.TextColor3 = Color3.fromRGB(255, 255, 255)
    joiningIconText.Font = Enum.Font.GothamBold
    joiningIconText.TextSize = 18 * scaleFactor
    joiningIconText.Parent = joiningIcon
    local joiningTitle = Instance.new("TextLabel")
    joiningTitle.Size = UDim2.new(1, -55 * scaleFactor, 0, 20 * scaleFactor)
    joiningTitle.Position = UDim2.new(0, (isMobile and 38 or 52) * scaleFactor, 0, (isMobile and 4 or 8) * scaleFactor)
    joiningTitle.BackgroundTransparency = 1
    joiningTitle.Text = "Trying to join..."
    joiningTitle.TextColor3 = Color3.fromRGB(100, 255, 150)
    joiningTitle.Font = Enum.Font.GothamBold
    joiningTitle.TextSize = (isMobile and 11 or 13) * scaleFactor
    joiningTitle.TextXAlignment = Enum.TextXAlignment.Left
    joiningTitle.Parent = UI.joiningNotifyFrame
    UI.joiningSubtitle = Instance.new("TextLabel")
    UI.joiningSubtitle.Size = UDim2.new(1, -55 * scaleFactor, 0, 20 * scaleFactor)
    UI.joiningSubtitle.Position = UDim2.new(0, (isMobile and 38 or 52) * scaleFactor, 0, (isMobile and 22 or 30) * scaleFactor)
    UI.joiningSubtitle.BackgroundTransparency = 1
    UI.joiningSubtitle.Text = "Connecting to server..."
    UI.joiningSubtitle.TextColor3 = Color3.fromRGB(240, 240, 250)
    UI.joiningSubtitle.Font = Enum.Font.GothamBold
    UI.joiningSubtitle.TextSize = (isMobile and 12 or 14) * scaleFactor
    UI.joiningSubtitle.TextXAlignment = Enum.TextXAlignment.Left
    UI.joiningSubtitle.TextTruncate = Enum.TextTruncate.AtEnd
    UI.joiningSubtitle.Parent = UI.joiningNotifyFrame
end
UI.Toast = Instance.new("Frame")
UI.Toast.Size = UDim2.new(0, 260 * scaleFactor, 0, 52 * scaleFactor)
UI.Toast.Position = UDim2.new(1, 10 * scaleFactor, 0, 10 * scaleFactor)
UI.Toast.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
UI.Toast.BorderSizePixel = 0
UI.Toast.Visible = false
UI.Toast.Parent = UI.ScreenGui
Instance.new("UICorner", UI.Toast).CornerRadius = UDim.new(0, 10 * scaleFactor)
local toastStroke = Instance.new("UIStroke")
toastStroke.Color = Color3.fromRGB(70, 180, 100)
toastStroke.Thickness = 1.5 * scaleFactor
toastStroke.Parent = UI.Toast
local toastDot = Instance.new("Frame")
toastDot.Size = UDim2.new(0, 14 * scaleFactor, 0, 14 * scaleFactor)
toastDot.Position = UDim2.new(0, 16 * scaleFactor, 0.5, -7 * scaleFactor)
toastDot.BackgroundColor3 = Color3.fromRGB(70, 180, 100)
toastDot.BorderSizePixel = 0
toastDot.Parent = UI.Toast
Instance.new("UICorner", toastDot).CornerRadius = UDim.new(1, 0)
UI.ToastText = Instance.new("TextLabel")
UI.ToastText.Size = UDim2.new(1, -40 * scaleFactor, 1, 0)
UI.ToastText.Position = UDim2.new(0, 38 * scaleFactor, 0, 0)
UI.ToastText.BackgroundTransparency = 1
UI.ToastText.Text = "Joining..."
UI.ToastText.TextColor3 = Color3.fromRGB(240, 240, 250)
UI.ToastText.Font = Enum.Font.GothamBold
UI.ToastText.TextSize = 13 * scaleFactor
UI.ToastText.TextXAlignment = Enum.TextXAlignment.Left
UI.ToastText.TextTruncate = Enum.TextTruncate.AtEnd
UI.ToastText.Parent = UI.Toast
local function updateSwitch()
    if State.autojoiner_enabled then
        TweenService:Create(UI.Switch, Tweens.switch, {BackgroundColor3 = Color3.fromRGB(70, 180, 100)}):Play()
        TweenService:Create(UI.SwitchDot, Tweens.switch, {Position = UDim2.new(1, -20 * scaleFactor, 0.5, -9 * scaleFactor), BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
        TweenService:Create(UI.StatusDot, Tweens.smooth, {BackgroundColor3 = Color3.fromRGB(70, 180, 100)}):Play()
        TweenService:Create(UI.MinDot, Tweens.smooth, {BackgroundColor3 = Color3.fromRGB(70, 180, 100)}):Play()
    else
        TweenService:Create(UI.Switch, Tweens.switch, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
        TweenService:Create(UI.SwitchDot, Tweens.switch, {Position = UDim2.new(0, 2 * scaleFactor, 0.5, -9 * scaleFactor), BackgroundColor3 = Color3.fromRGB(150, 150, 160)}):Play()
        TweenService:Create(UI.StatusDot, Tweens.smooth, {BackgroundColor3 = Color3.fromRGB(70, 70, 80)}):Play()
        TweenService:Create(UI.MinDot, Tweens.smooth, {BackgroundColor3 = Color3.fromRGB(70, 70, 80)}):Play()
    end
end
local function pasteAndClick(jobId)
    jobId = cleanJobId(jobId)
    local searchLocations = {
        CoreGui,
    }
  
    for _, container in pairs(CoreGui:GetChildren()) do
        if container:IsA("Folder") then
            table.insert(searchLocations, container)
        end
    end
  
    local robloxGui = CoreGui:FindFirstChild("RobloxGui")
    if robloxGui then
        table.insert(searchLocations, robloxGui)
    end
  
    for _, location in pairs(searchLocations) do
        local chilliLibUI = location:FindFirstChild("ChilliLibUI")
        if chilliLibUI then
            local mainBase = chilliLibUI:FindFirstChild("MainBase")
            if not mainBase then continue end
          
            local firstFrame = mainBase:FindFirstChild("Frame")
            if not firstFrame then continue end
          
            local framesUnderFirst = {}
            for _, child in pairs(firstFrame:GetChildren()) do
                if child:IsA("Frame") and child.Name == "Frame" then
                    table.insert(framesUnderFirst, child)
                end
            end
            if #framesUnderFirst < 2 then continue end
          
            local secondFrame = framesUnderFirst[2]
            local scrollingFrames = {}
            for _, child in pairs(secondFrame:GetChildren()) do
                if child:IsA("ScrollingFrame") and child.Name == "ScrollingFrame" then
                    table.insert(scrollingFrames, child)
                end
            end
            if #scrollingFrames < 6 then continue end
          
            local sixthScroll = scrollingFrames[6]
            local frameInScroll = sixthScroll:FindFirstChild("Frame")
            if not frameInScroll then continue end
          
            local contentHolder = frameInScroll:FindFirstChild("ContentHolder")
            if not contentHolder then continue end
          
            local contentFrames = {}
            for _, child in pairs(contentHolder:GetChildren()) do
                if child:IsA("Frame") and child.Name == "Frame" then
                    table.insert(contentFrames, child)
                end
            end
            if #contentFrames < 4 then continue end
          
            local thirdFrame = contentFrames[3]
            local textBox = nil
            local innerFrame = thirdFrame:FindFirstChild("Frame")
            if innerFrame then
                textBox = innerFrame:FindFirstChildOfClass("TextBox")
            end
            if not textBox then continue end
          
            local fourthFrame = contentFrames[4]
            local textButton = fourthFrame:FindFirstChildOfClass("TextButton")
            if textButton and textButton.Text ~= "Join Job-ID" then
                textButton = nil
                for _, child in pairs(fourthFrame:GetChildren()) do
                    if child:IsA("TextButton") and child.Text == "Join Job-ID" then
                        textButton = child
                        break
                    end
                end
            end
            if not textButton then continue end
            textBox.Text = jobId
            pcall(function() for _, c in pairs(safeGetConnections(textBox.FocusLost)) do c:Fire() end end)
            pcall(function() for _, c in pairs(safeGetConnections(textBox:GetPropertyChangedSignal("Text"))) do c:Fire() end end)
            pcall(function() for _, c in pairs(safeGetConnections(textButton.MouseButton1Click)) do c:Fire() end end)
            pcall(function() for _, c in pairs(safeGetConnections(textButton.MouseButton1Down)) do c:Fire() end end)
            pcall(function() for _, c in pairs(safeGetConnections(textButton.Activated)) do c:Fire() end end)
          
            State.successfully_joined = true
            return true
        end
    end
  
    return false
end
local function safeGetConnections(signal)
    if not getconnections then return {} end
  
    local success, connections = pcall(function()
        return getconnections(signal)
    end)
  
    if success and connections then
        return connections
    end
  
    return {}
end
local function findMatchingPetName(partial)
    if not partial or partial == "" then return nil end
    partial = partial:lower()
  
    local bestMatch = nil
    local bestMatchLength = math.huge
    for _, petName in pairs(BrainrotNames) do
        local lowerPetName = petName:lower()
        if lowerPetName:find(partial, 1, true) then
            if #petName < bestMatchLength then
                bestMatch = petName
                bestMatchLength = #petName
            end
        end
    end
  
    return bestMatch
end
local function addIgnoreEntry(name)
    if not name or name == "" then return end
    name = name:match("^%s*(.-)%s*$")
    if name == "" or table.find(State.ignoreList, name) then return end
    table.insert(State.ignoreList, name)
    saveIgnoreList()
    local entry = Instance.new("Frame")
    entry.Size = UDim2.new(1, -8 * scaleFactor, 0, 32 * scaleFactor)
    entry.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
    entry.BorderSizePixel = 0
    entry:SetAttribute("Name", name)
    entry.Parent = UI.IgnoreScroll
    Instance.new("UICorner", entry).CornerRadius = UDim.new(0, 6 * scaleFactor)
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, -36 * scaleFactor, 1, 0)
    nameLabel.Position = UDim2.new(0, 10 * scaleFactor, 0, 0)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = Color3.fromRGB(220, 220, 230)
    nameLabel.Font = Enum.Font.GothamBold
    nameLabel.TextSize = 13 * scaleFactor
    nameLabel.TextXAlignment = Enum.TextXAlignment.Left
    nameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    nameLabel.Parent = entry
    local removeBtn = Instance.new("TextButton")
    removeBtn.Size = UDim2.new(0, 26 * scaleFactor, 0, 26 * scaleFactor)
    removeBtn.Position = UDim2.new(1, -30 * scaleFactor, 0.5, -13 * scaleFactor)
    removeBtn.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
    removeBtn.BorderSizePixel = 0
    removeBtn.Text = "×"
    removeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    removeBtn.Font = Enum.Font.GothamBold
    removeBtn.TextSize = 15 * scaleFactor
    removeBtn.AutoButtonColor = false
    removeBtn.Parent = entry
    Instance.new("UICorner", removeBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
    removeBtn.MouseButton1Click:Connect(function()
        local idx = table.find(State.ignoreList, name)
        if idx then table.remove(State.ignoreList, idx) end
        saveIgnoreList()
        entry:Destroy()
    end)
    removeBtn.MouseEnter:Connect(function()
        TweenService:Create(removeBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(230, 80, 80)}):Play()
    end)
    removeBtn.MouseLeave:Connect(function()
        TweenService:Create(removeBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(200, 60, 60)}):Play()
    end)
    entry.BackgroundTransparency = 1
    nameLabel.TextTransparency = 1
    removeBtn.BackgroundTransparency = 1
    removeBtn.TextTransparency = 1
    TweenService:Create(entry, Tweens.smooth, {BackgroundTransparency = 0}):Play()
    TweenService:Create(nameLabel, Tweens.smooth, {TextTransparency = 0}):Play()
    TweenService:Create(removeBtn, Tweens.smooth, {BackgroundTransparency = 0, TextTransparency = 0}):Play()
end
local function showJoiningNotification(petName, ms, jobId, force)
    local now = tick()
    if now - State.lastJoinNotifyTime < 1 then return end
    State.lastJoinNotifyTime = now
    if not State.join_notify_enabled then return end
    if not force and jobId and jobId == State.lastNotifiedJob then return end
    if jobId then State.lastNotifiedJob = jobId end
    UI.joiningSubtitle.Text = petName .. " - $" .. tostring(ms) .. "M/s"
    UI.joiningNotifyFrame.Visible = true
    UI.joiningNotifyFrame.Position = UDim2.new(1, 0, 0, 80 * scaleFactor)
    local slideIn = TweenService:Create(UI.joiningNotifyFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.Out), { Position = UDim2.new(1, (isMobile and -330 or -430) * scaleFactor, 0, 80 * scaleFactor) })
    slideIn:Play()
    if State.joiningHideTimer then task.cancel(State.joiningHideTimer) end
    State.joiningHideTimer = task.delay(3, function()
        local slideOut = TweenService:Create(UI.joiningNotifyFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quint, Enum.EasingDirection.In), { Position = UDim2.new(1, 0, 0, (isMobile and 10 or 80) * scaleFactor) })
        slideOut:Play()
        slideOut.Completed:Connect(function()
            UI.joiningNotifyFrame.Visible = false
        end)
    end)
end
local function addServerLog(data)
    if not data or not data.name or not data.ms or not data.job then return end
    local ms = tonumber(data.ms) or 0
    local playersInServer = 0
    local playersText = "?/8"
    if data.players then
        playersText = tostring(data.players)
        local num = tostring(data.players):match("^(%d+)")
        playersInServer = tonumber(num) or 0
    end
    if ms < State.minimum_ms then return end
    if State.max_players and playersInServer > State.max_players then return end
    local entry = Instance.new("Frame")
    entry.Size = UDim2.new(1, 0, 0, 48 * scaleFactor)
    entry.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
    entry.BorderSizePixel = 0
    entry:SetAttribute("JobID", data.job)
entry:SetAttribute("IsLooping", false)
entry:SetAttribute("OriginalLayoutOrder", State.currentLayoutOrder)
entry.LayoutOrder = State.currentLayoutOrder
    State.currentLayoutOrder = State.currentLayoutOrder - 1
    local accentLine = Instance.new("Frame")
    accentLine.Size = UDim2.new(0, 3 * scaleFactor, 1, 0)
    accentLine.Position = UDim2.new(0, 0, 0, 0)
    accentLine.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    accentLine.BorderSizePixel = 0
    accentLine.Parent = entry
    Instance.new("UICorner", accentLine).CornerRadius = UDim.new(0, 2 * scaleFactor)
    local displayName = data.name
if #displayName > 19 then
    displayName = displayName:sub(1, 19) .. ".."
end
   local petLabel = Instance.new("TextLabel")
petLabel.Size = UDim2.new(0, 165 * scaleFactor, 1, 0)
petLabel.Position = UDim2.new(0, 14 * scaleFactor, 0, 0)
petLabel.BackgroundTransparency = 1
petLabel.Text = displayName
petLabel.TextColor3 = Color3.fromRGB(240, 240, 250)
petLabel.Font = Enum.Font.GothamBold
petLabel.TextSize = 13 * scaleFactor
petLabel.TextXAlignment = Enum.TextXAlignment.Left
petLabel.TextTruncate = Enum.TextTruncate.None
petLabel.Parent = entry
    local msLabel = Instance.new("TextLabel")
    msLabel.Size = UDim2.new(0, 90 * scaleFactor, 1, 0)
    msLabel.Position = UDim2.new(0, 162 * scaleFactor, 0, 0)
    msLabel.BackgroundTransparency = 1
    msLabel.Text = "$" .. data.ms .. "M/s"
    msLabel.TextColor3 = Color3.fromRGB(100, 255, 150)
    msLabel.Font = Enum.Font.GothamBold
    msLabel.TextSize = 13 * scaleFactor
    msLabel.TextXAlignment = Enum.TextXAlignment.Left
    msLabel.Parent = entry
    local playersLabel = Instance.new("TextLabel")
    playersLabel.Size = UDim2.new(0, 60 * scaleFactor, 1, 0)
    playersLabel.Position = UDim2.new(0, 227 * scaleFactor, 0, 0)
    playersLabel.BackgroundTransparency = 1
    playersLabel.Text = playersText
    playersLabel.TextColor3 = Color3.fromRGB(160, 160, 175)
    playersLabel.Font = Enum.Font.GothamBold
    playersLabel.TextSize = 13 * scaleFactor
    playersLabel.Parent = entry
    local joinBtn = Instance.new("TextButton")
    joinBtn.Size = UDim2.new(0, 52 * scaleFactor, 0, 30 * scaleFactor)
    joinBtn.Position = UDim2.new(1, -114 * scaleFactor, 0.5, -14 * scaleFactor)
    joinBtn.BackgroundColor3 = Color3.fromRGB(70, 180, 100)
    joinBtn.BorderSizePixel = 0
    joinBtn.Text = "JOIN"
    joinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    joinBtn.Font = Enum.Font.GothamBold
    joinBtn.TextSize = 12 * scaleFactor
    joinBtn.AutoButtonColor = false
    joinBtn.Parent = entry
    Instance.new("UICorner", joinBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
 
local joinStroke = Instance.new("UIStroke")
joinStroke.Color = Color3.fromRGB(70, 180, 100)
joinStroke.Thickness = 1 * scaleFactor
joinStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
joinStroke.Parent = joinBtn
local joinBorderGradient = Instance.new("UIGradient")
joinBorderGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(70, 180, 100)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(70, 180, 100)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(70, 180, 100))
}
joinBorderGradient.Parent = joinStroke
local loopBtn = Instance.new("TextButton")
loopBtn.Name = "LoopBtn"
loopBtn.Size = UDim2.new(0, 52 * scaleFactor, 0, 30 * scaleFactor)
loopBtn.Position = UDim2.new(1, -57 * scaleFactor, 0.5, -14 * scaleFactor)
loopBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 28)
loopBtn.BorderSizePixel = 0
loopBtn.Text = ""
loopBtn.AutoButtonColor = false
loopBtn.Parent = entry
Instance.new("UICorner", loopBtn).CornerRadius = UDim.new(0, 5 * scaleFactor)
local loopStroke = Instance.new("UIStroke")
loopStroke.Color = Color3.fromRGB(255, 255, 255)
loopStroke.Thickness = 1 * scaleFactor
loopStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
loopStroke.Parent = loopBtn
local loopBorderGradient = Instance.new("UIGradient")
loopBorderGradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 150, 160)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 150, 160))
}
loopBorderGradient.Parent = loopStroke
local loopText = Instance.new("TextLabel")
loopText.Size = UDim2.new(1, 0, 1, 0)
loopText.BackgroundTransparency = 1
loopText.Text = "LOOP"
loopText.TextColor3 = Color3.fromRGB(200, 200, 210)
loopText.Font = Enum.Font.GothamBold
loopText.TextSize = 11 * scaleFactor
loopText.Parent = loopBtn
Instance.new("UICorner", loopBtn).CornerRadius = UDim.new(0, 6 * scaleFactor)
    entry.BackgroundTransparency = 1
    accentLine.BackgroundTransparency = 1
    petLabel.TextTransparency = 1
    msLabel.TextTransparency = 1
    playersLabel.TextTransparency = 1
    joinBtn.BackgroundTransparency = 1
    joinBtn.TextTransparency = 1
    loopBtn.BackgroundTransparency = 0
    loopBtn.TextTransparency = 1
    entry.Parent = UI.LogsScroll
    TweenService:Create(entry, Tweens.smooth, {BackgroundTransparency = 0}):Play()
    TweenService:Create(accentLine, Tweens.smooth, {BackgroundTransparency = 0}):Play()
    TweenService:Create(petLabel, Tweens.smooth, {TextTransparency = 0}):Play()
    TweenService:Create(msLabel, Tweens.smooth, {TextTransparency = 0}):Play()
    TweenService:Create(playersLabel, Tweens.smooth, {TextTransparency = 0}):Play()
    TweenService:Create(joinBtn, Tweens.smooth, {BackgroundTransparency = 0, TextTransparency = 0}):Play()
    TweenService:Create(loopBtn, Tweens.smooth, {TextTransparency = 0}):Play()
    joinBtn.MouseButton1Click:Connect(function()
        showJoiningNotification(data.name, data.ms, data.job, true)
        pasteAndClick(data.job)
    end)
    joinBtn.MouseEnter:Connect(function()
        TweenService:Create(joinBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(90, 200, 120)}):Play()
    end)
    joinBtn.MouseLeave:Connect(function()
        TweenService:Create(joinBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(70, 180, 100)}):Play()
    end)
   loopBtn.MouseButton1Click:Connect(function()
    local isLooping = entry:GetAttribute("IsLooping")
    isLooping = not isLooping
    entry:SetAttribute("IsLooping", isLooping)
    if isLooping then
        TweenService:Create(loopStroke, Tweens.fast, {Color = Color3.fromRGB(255, 70, 70)}):Play()
        TweenService:Create(loopText, Tweens.fast, {TextColor3 = Color3.fromRGB(255, 80, 80)}):Play()
        TweenService:Create(accentLine, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(255, 70, 70)}):Play()
       
        loopBorderGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(180, 50, 50)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 70, 70)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(180, 50, 50))
        }
       
        entry.LayoutOrder = - (1000000000 + tick())
        showJoiningNotification(data.name, data.ms, data.job, true)
       
        if State.loop_timeout > 0 then
            local jobId = entry:GetAttribute("JobID")
            if State.loopTimers[jobId] then
                task.cancel(State.loopTimers[jobId])
            end
           
            State.loopTimers[jobId] = task.delay(State.loop_timeout, function()
                if entry and entry.Parent and entry:GetAttribute("IsLooping") then
                    entry:SetAttribute("IsLooping", false)
                    TweenService:Create(loopStroke, Tweens.fast, {Color = Color3.fromRGB(255, 255, 255)}):Play()
                    TweenService:Create(loopText, Tweens.fast, {TextColor3 = Color3.fromRGB(200, 200, 210)}):Play()
                    TweenService:Create(accentLine, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
                   
                    loopBorderGradient.Color = ColorSequence.new{
                        ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 150, 160)),
                        ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 255)),
                        ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 150, 160))
                    }
                   
                    entry.LayoutOrder = entry:GetAttribute("OriginalLayoutOrder") or State.currentLayoutOrder
                end
                State.loopTimers[jobId] = nil
            end)
        end
       
    else
        local jobId = entry:GetAttribute("JobID")
        if State.loopTimers[jobId] then
            task.cancel(State.loopTimers[jobId])
            State.loopTimers[jobId] = nil
        end
       
        TweenService:Create(loopStroke, Tweens.fast, {Color = Color3.fromRGB(255, 255, 255)}):Play()
        TweenService:Create(loopText, Tweens.fast, {TextColor3 = Color3.fromRGB(200, 200, 210)}):Play()
        TweenService:Create(accentLine, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
       
        loopBorderGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0, Color3.fromRGB(150, 150, 160)),
            ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 255)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(150, 150, 160))
        }
       
        entry.LayoutOrder = entry:GetAttribute("OriginalLayoutOrder") or State.currentLayoutOrder
    end
end)
    entry.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(entry, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(28, 28, 38)}):Play()
        end
    end)
    entry.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            TweenService:Create(entry, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(20, 20, 28)}):Play()
        end
    end)
end
UI.TimeoutInput.FocusLost:Connect(function()
    local v = tonumber(UI.TimeoutInput.Text)
    if v and v >= 0 then
        State.loop_timeout = v
        pcall(function() writefile("cloudy_loop_timeout.txt", tostring(v)) end)
    else
        UI.TimeoutInput.Text = tostring(State.loop_timeout)
    end
end)
UI.Switch.MouseButton1Click:Connect(function()
    State.autojoiner_enabled = not State.autojoiner_enabled
    updateSwitch()
end)
UI.Switch.MouseEnter:Connect(function()
    TweenService:Create(UI.SwitchDot, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(255, 255, 255)}):Play()
end)
UI.Switch.MouseLeave:Connect(function()
    local c = State.autojoiner_enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(150, 150, 160)
    TweenService:Create(UI.SwitchDot, Tweens.fast, {BackgroundColor3 = c}):Play()
end)
UI.SettingsBtn.MouseButton1Click:Connect(function()
    State.settingsOpen = not State.settingsOpen
    if State.settingsOpen then
        UI.SettingsPopup.Visible = true
        UI.SettingsPopup.BackgroundTransparency = 1
        for _, child in pairs(UI.SettingsPopup:GetChildren()) do
            if child:IsA("Frame") or child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                child.BackgroundTransparency = 1
                if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                    child.TextTransparency = 1
                end
            end
        end
       TweenService:Create(UI.SettingsPopup, Tweens.filterOpen, {
    Position = isMobile and UDim2.new(0, 430 * scaleFactor, 0, 50 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 50 * scaleFactor),
    BackgroundTransparency = 0
}):Play()
        for _, child in pairs(UI.SettingsPopup:GetChildren()) do
            if child:IsA("Frame") then
                TweenService:Create(child, Tweens.filterOpen, {BackgroundTransparency = 0}):Play()
            elseif child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                TweenService:Create(child, Tweens.filterOpen, {TextTransparency = 0}):Play()
            end
        end
    else
        TweenService:Create(UI.SettingsPopup, Tweens.filterOpen, {
    Position = isMobile and UDim2.new(0, 430 * scaleFactor, 0, 50 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 50 * scaleFactor),
    BackgroundTransparency = 0
}):Play()
        for _, child in pairs(UI.SettingsPopup:GetChildren()) do
            if child:IsA("Frame") then
                TweenService:Create(child, Tweens.filterClose, {BackgroundTransparency = 1}):Play()
            elseif child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                TweenService:Create(child, Tweens.filterClose, {TextTransparency = 1}):Play()
            end
        end
        task.delay(0.35, function()
            if not State.settingsOpen then UI.SettingsPopup.Visible = false end
        end)
    end
end)
UI.SettingsBtn.MouseEnter:Connect(function()
    TweenService:Create(UI.SettingsBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
end)
UI.SettingsBtn.MouseLeave:Connect(function()
    TweenService:Create(UI.SettingsBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
end)
local originalTransparencies = {}




UI.MinBtn.MouseButton1Click:Connect(function()
    if State.isAnimating then return end
    State.minimized = true
    State.savedMainPosition = UI.Main.Position
  
    if State.settingsOpen then
        TweenService:Create(UI.SettingsPopup, Tweens.smooth, {
            Position = UDim2.new(0, -250 * scaleFactor, 0, 80 * scaleFactor),
            BackgroundTransparency = 1
        }):Play()
      
        for _, child in pairs(UI.SettingsPopup:GetDescendants()) do
            if child:IsA("GuiObject") or child:IsA("UIStroke") then
                if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                    originalTransparencies[child:GetDebugId() .. "_Text"] = child.TextTransparency
                end
                if child:IsA("GuiObject") then
                    originalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
                end
                if child:IsA("UIStroke") then
                    originalTransparencies[child:GetDebugId() .. "_Stroke"] = child.Transparency
                end
            end
            if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                TweenService:Create(child, Tweens.smooth, {TextTransparency = 1}):Play()
            end
            if child:IsA("GuiObject") then
                TweenService:Create(child, Tweens.smooth, {BackgroundTransparency = 1}):Play()
            end
            if child:IsA("UIStroke") then
                TweenService:Create(child, Tweens.smooth, {Transparency = 1}):Play()
            end
        end
    end
    TweenService:Create(UI.Main, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 680 * scaleFactor, 0, 0)
    }):Play()
  
    task.delay(0.35, function()
        UI.Main.Visible = false
        if State.settingsOpen then
            UI.SettingsPopup.Visible = false
        end
        UI.MinBar.Visible = true
        UI.MinBar.Size = UDim2.new(0, 0, 0, 38 * scaleFactor)
        TweenService:Create(UI.MinBar, Tweens.bounce, {Size = UDim2.new(0, (isMobile and 200 or 240) * scaleFactor, 0, 38 * scaleFactor)}):Play()
        task.delay(0.5, function()  -- ADD THESE 3 LINES
            State.isAnimating = false
        end)
    end)
end)
UI.MinBtn.MouseEnter:Connect(function()
    TweenService:Create(UI.MinBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
end)
UI.MinBtn.MouseLeave:Connect(function()
    TweenService:Create(UI.MinBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
end)


if not isMobile then
    UI.ExpandBtn.MouseButton1Click:Connect(expandUI)
    
    UI.ExpandBtn.MouseEnter:Connect(function()
        TweenService:Create(UI.ExpandBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(50, 50, 65)}):Play()
    end)
    
    UI.ExpandBtn.MouseLeave:Connect(function()
        TweenService:Create(UI.ExpandBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
    end)
end

local function expandUI()
    if State.isAnimating then return end  -- ADD THIS LINE
    State.isAnimating = true  -- ADD T
    State.minimized = false
    State.savedMinBarPosition = UI.MinBar.Position  -- Save current position before expanding
    
    -- Store original properties
    local minOriginalTransparencies = {}
    minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_BG"] = UI.MinBar.BackgroundTransparency
    minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_Size"] = UI.MinBar.Size
    minOriginalTransparencies[minStroke:GetDebugId() .. "_Stroke"] = minStroke.Transparency
    minOriginalTransparencies[minStroke:GetDebugId() .. "_Thickness"] = minStroke.Thickness
    minOriginalTransparencies[minStroke:GetDebugId() .. "_Color"] = minStroke.Color
    
    for _, child in pairs(UI.MinBar:GetDescendants()) do
        if child:IsA("TextLabel") or child:IsA("TextButton") then
            minOriginalTransparencies[child:GetDebugId() .. "_Text"] = child.TextTransparency
            minOriginalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
        end
        if child:IsA("Frame") and child ~= UI.MinBar then
            minOriginalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
        end
        if child:IsA("UIStroke") and child ~= minStroke then
            minOriginalTransparencies[child:GetDebugId() .. "_Stroke"] = child.Transparency
        end
    end
    
    -- Click effect on MinBar
    TweenService:Create(UI.MinBar, TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, (isMobile and 210 or 250) * scaleFactor, 0, 42 * scaleFactor)
    }):Play()
    TweenService:Create(minStroke, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Thickness = 4 * scaleFactor,
        Color = Color3.fromRGB(150, 200, 255)
    }):Play()
    
    -- Then fade out
    task.delay(0.1, function()
        TweenService:Create(UI.MinBar, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
            BackgroundTransparency = 1
        }):Play()
        TweenService:Create(minStroke, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
            Transparency = 1
        }):Play()
        
        for _, child in pairs(UI.MinBar:GetDescendants()) do
            if child:IsA("TextLabel") or child:IsA("TextButton") then
                TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                    TextTransparency = 1
                }):Play()
                TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                    BackgroundTransparency = 1
                }):Play()
            end
            if child:IsA("Frame") and child ~= UI.MinBar then
                TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                    BackgroundTransparency = 1
                }):Play()
            end
            if child:IsA("UIStroke") and child ~= minStroke then
                TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                    Transparency = 1
                }):Play()
            end
        end
    end)
    
    task.delay(0.35, function()
        UI.MinBar.Visible = false
        
        -- Reset all transparencies and properties to originals
        UI.MinBar.BackgroundTransparency = minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_BG"]
        UI.MinBar.Size = minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_Size"]
        minStroke.Transparency = minOriginalTransparencies[minStroke:GetDebugId() .. "_Stroke"]
        minStroke.Thickness = minOriginalTransparencies[minStroke:GetDebugId() .. "_Thickness"]
        minStroke.Color = minOriginalTransparencies[minStroke:GetDebugId() .. "_Color"]
        
        for _, child in pairs(UI.MinBar:GetDescendants()) do
            local textKey = child:GetDebugId() .. "_Text"
            local bgKey = child:GetDebugId() .. "_BG"
            local strokeKey = child:GetDebugId() .. "_Stroke"
            
            if minOriginalTransparencies[textKey] ~= nil then
                child.TextTransparency = minOriginalTransparencies[textKey]
            end
            if minOriginalTransparencies[bgKey] ~= nil then
                child.BackgroundTransparency = minOriginalTransparencies[bgKey]
            end
            if minOriginalTransparencies[strokeKey] ~= nil then
                child.Transparency = minOriginalTransparencies[strokeKey]
            end
        end
        
        -- Show Main UI
        UI.Main.Visible = true
        UI.Main.Size = UDim2.new(0, 680 * scaleFactor, 0, 0)
        UI.Main.Position = State.savedMainPosition or UDim2.new(0.5, -340 * scaleFactor, 0.5, -210 * scaleFactor)
        
        if State.settingsOpen then
            UI.SettingsPopup.Visible = true
            UI.SettingsPopup.Position = isMobile and UDim2.new(0, 670 * scaleFactor, 0, 80 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 80 * scaleFactor)
            UI.SettingsPopup.BackgroundTransparency = 1
             TweenService:Create(UI.SettingsPopup, Tweens.bounce, {
        Position = isMobile and UDim2.new(0, 430 * scaleFactor, 0, 50 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 50 * scaleFactor),
        BackgroundTransparency = 0
    }):Play()
            task.delay(0.1, function()
                for _, child in pairs(UI.SettingsPopup:GetDescendants()) do
                    if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                        local original = originalTransparencies[child:GetDebugId() .. "_Text"] or 0
                        TweenService:Create(child, Tweens.bounce, {TextTransparency = original}):Play()
                    end
                    if child:IsA("GuiObject") then
                        local original = originalTransparencies[child:GetDebugId() .. "_BG"] or 0
                        TweenService:Create(child, Tweens.bounce, {BackgroundTransparency = original}):Play()
                    end
                    if child:IsA("UIStroke") then
                        local original = originalTransparencies[child:GetDebugId() .. "_Stroke"] or 0
                        TweenService:Create(child, Tweens.bounce, {Transparency = original}):Play()
                    end
                end
            end)
        end
        
        TweenService:Create(UI.Main, Tweens.bounce, {Size = UDim2.new(0, 680 * scaleFactor, 0, 420 * scaleFactor)}):Play()
         task.delay(0.5, function()  -- ADD THESE 3 LINES
            State.isAnimating = false
        end)
    end)
end

if not isMobile then
    UI.ExpandBtn.MouseButton1Click:Connect(function()
        TweenService:Create(UI.ExpandBtn, TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
            Size = UDim2.new(0, 30 * scaleFactor, 0, 28 * scaleFactor),
            BackgroundColor3 = Color3.fromRGB(70, 70, 95)
        }):Play()
        
        task.delay(0.1, function()
            TweenService:Create(UI.ExpandBtn, TweenInfo.new(0.15, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = UDim2.new(0, 26 * scaleFactor, 0, 24 * scaleFactor),
                BackgroundColor3 = Color3.fromRGB(35, 35, 45)
            }):Play()
        end)
        
        expandUI()
    end)
end


UI.AddBtn.MouseButton1Click:Connect(function()
    local input = UI.AddInput.Text
    if input and input ~= "" then
        local fullName = findMatchingPetName(input)
      
        if fullName then
            addIgnoreEntry(fullName)
            UI.AddInput.Text = ""
        else
            addIgnoreEntry(input)
            UI.AddInput.Text = ""
        end
    end
end)
UI.AddBtn.MouseEnter:Connect(function()
    TweenService:Create(UI.AddBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(230, 80, 80)}):Play()
end)
UI.AddBtn.MouseLeave:Connect(function()
    TweenService:Create(UI.AddBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(200, 60, 60)}):Play()
end)
UI.MoneyInput.FocusLost:Connect(function()
    local v = tonumber(UI.MoneyInput.Text)
    if v and v >= 0 then
        State.minimum_ms = v
        pcall(function() writefile("cloudy_min_ms.txt", tostring(v)) end)
    else
        UI.MoneyInput.Text = State.minimum_ms > 0 and tostring(State.minimum_ms) or ""
    end
end)
UI.MaxBtn.MouseEnter:Connect(function()
    TweenService:Create(UI.MaxBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}):Play()
end)
UI.MaxBtn.MouseLeave:Connect(function()
    TweenService:Create(UI.MaxBtn, Tweens.fast, {BackgroundColor3 = Color3.fromRGB(25, 25, 32)}):Play()
end)
local function applyFOV()
    if game.Workspace.CurrentCamera then
        game.Workspace.CurrentCamera.FieldOfView = State.custom_fov
    end
end
task.spawn(function()
    repeat task.wait() until game:IsLoaded()
    task.wait(1)
    applyFOV()
    for i = 1, 5 do
        task.wait(1)
        applyFOV()
    end
end)
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if State.keybindDebounce then return end -- Prevent spam
    
    if input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode.Name == State.ui_keybind then
            State.keybindDebounce = true
            
            if State.minimized then
                -- Expand UI with click effect
                State.minimized = false
                State.savedMinBarPosition = UI.MinBar.Position
                
                -- Store original properties
                local minOriginalTransparencies = {}
                minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_BG"] = UI.MinBar.BackgroundTransparency
                minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_Size"] = UI.MinBar.Size
                minOriginalTransparencies[minStroke:GetDebugId() .. "_Stroke"] = minStroke.Transparency
                minOriginalTransparencies[minStroke:GetDebugId() .. "_Thickness"] = minStroke.Thickness
                minOriginalTransparencies[minStroke:GetDebugId() .. "_Color"] = minStroke.Color
                
                for _, child in pairs(UI.MinBar:GetDescendants()) do
                    if child:IsA("TextLabel") or child:IsA("TextButton") then
                        minOriginalTransparencies[child:GetDebugId() .. "_Text"] = child.TextTransparency
                        minOriginalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
                    end
                    if child:IsA("Frame") and child ~= UI.MinBar then
                        minOriginalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
                    end
                    if child:IsA("UIStroke") and child ~= minStroke then
                        minOriginalTransparencies[child:GetDebugId() .. "_Stroke"] = child.Transparency
                    end
                end
                
                -- Click effect on MinBar
                TweenService:Create(UI.MinBar, TweenInfo.new(0.1, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                    Size = UDim2.new(0, (isMobile and 210 or 250) * scaleFactor, 0, 42 * scaleFactor)
                }):Play()
                TweenService:Create(minStroke, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    Thickness = 4 * scaleFactor,
                    Color = Color3.fromRGB(150, 200, 255)
                }):Play()
                
                -- Then fade out
                task.delay(0.1, function()
                    TweenService:Create(UI.MinBar, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                        BackgroundTransparency = 1
                    }):Play()
                    TweenService:Create(minStroke, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                        Transparency = 1
                    }):Play()
                    
                    for _, child in pairs(UI.MinBar:GetDescendants()) do
                        if child:IsA("TextLabel") or child:IsA("TextButton") then
                            TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                                TextTransparency = 1
                            }):Play()
                            TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                                BackgroundTransparency = 1
                            }):Play()
                        end
                        if child:IsA("Frame") and child ~= UI.MinBar then
                            TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                                BackgroundTransparency = 1
                            }):Play()
                        end
                        if child:IsA("UIStroke") and child ~= minStroke then
                            TweenService:Create(child, TweenInfo.new(0.2, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                                Transparency = 1
                            }):Play()
                        end
                    end
                end)
                
                task.delay(0.35, function()
                    UI.MinBar.Visible = false
                    
                    -- Reset all transparencies and properties to originals
                    UI.MinBar.BackgroundTransparency = minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_BG"]
                    UI.MinBar.Size = minOriginalTransparencies[UI.MinBar:GetDebugId() .. "_Size"]
                    minStroke.Transparency = minOriginalTransparencies[minStroke:GetDebugId() .. "_Stroke"]
                    minStroke.Thickness = minOriginalTransparencies[minStroke:GetDebugId() .. "_Thickness"]
                    minStroke.Color = minOriginalTransparencies[minStroke:GetDebugId() .. "_Color"]
                    
                    for _, child in pairs(UI.MinBar:GetDescendants()) do
                        local textKey = child:GetDebugId() .. "_Text"
                        local bgKey = child:GetDebugId() .. "_BG"
                        local strokeKey = child:GetDebugId() .. "_Stroke"
                        
                        if minOriginalTransparencies[textKey] ~= nil then
                            child.TextTransparency = minOriginalTransparencies[textKey]
                        end
                        if minOriginalTransparencies[bgKey] ~= nil then
                            child.BackgroundTransparency = minOriginalTransparencies[bgKey]
                        end
                        if minOriginalTransparencies[strokeKey] ~= nil then
                            child.Transparency = minOriginalTransparencies[strokeKey]
                        end
                    end
                    
                    -- Show Main UI
                    UI.Main.Visible = true
                    UI.Main.Size = UDim2.new(0, 680 * scaleFactor, 0, 0)
                    UI.Main.Position = State.savedMainPosition or UDim2.new(0.5, -340 * scaleFactor, 0.5, -210 * scaleFactor)
                    
                    if State.settingsOpen then
                        UI.SettingsPopup.Visible = true
                         UI.SettingsPopup.Position = isMobile and UDim2.new(0, 670 * scaleFactor, 0, 80 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 80 * scaleFactor)
                        UI.SettingsPopup.BackgroundTransparency = 1
                        TweenService:Create(UI.SettingsPopup, Tweens.smooth, {
        Position = isMobile and UDim2.new(0, 670 * scaleFactor, 0, 80 * scaleFactor) or UDim2.new(0, -250 * scaleFactor, 0, 80 * scaleFactor),
        BackgroundTransparency = 1
    }):Play()
                        task.delay(0.1, function()
                            for _, child in pairs(UI.SettingsPopup:GetDescendants()) do
                                if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                                    local original = originalTransparencies[child:GetDebugId() .. "_Text"] or 0
                                    TweenService:Create(child, Tweens.bounce, {TextTransparency = original}):Play()
                                end
                                if child:IsA("GuiObject") then
                                    local original = originalTransparencies[child:GetDebugId() .. "_BG"] or 0
                                    TweenService:Create(child, Tweens.bounce, {BackgroundTransparency = original}):Play()
                                end
                                if child:IsA("UIStroke") then
                                    local original = originalTransparencies[child:GetDebugId() .. "_Stroke"] or 0
                                    TweenService:Create(child, Tweens.bounce, {Transparency = original}):Play()
                                end
                            end
                        end)
                    end
                    
                    TweenService:Create(UI.Main, Tweens.bounce, {Size = UDim2.new(0, 680 * scaleFactor, 0, 420 * scaleFactor)}):Play()
                    
                    -- Re-enable keybind after animation completes
                    task.delay(0.15, function()
                        State.keybindDebounce = false
                    end)
                end)
            else
                -- Minimize UI
                State.minimized = true
                State.savedMainPosition = UI.Main.Position
                
                if State.settingsOpen then
                    TweenService:Create(UI.SettingsPopup, Tweens.smooth, {
                        Position = UDim2.new(0, -250 * scaleFactor, 0, 80 * scaleFactor),
                        BackgroundTransparency = 1
                    }):Play()
                    for _, child in pairs(UI.SettingsPopup:GetDescendants()) do
                        if child:IsA("GuiObject") or child:IsA("UIStroke") then
                            if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                                originalTransparencies[child:GetDebugId() .. "_Text"] = child.TextTransparency
                            end
                            if child:IsA("GuiObject") then
                                originalTransparencies[child:GetDebugId() .. "_BG"] = child.BackgroundTransparency
                            end
                            if child:IsA("UIStroke") then
                                originalTransparencies[child:GetDebugId() .. "_Stroke"] = child.Transparency
                            end
                        end
                        if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                            TweenService:Create(child, Tweens.smooth, {TextTransparency = 1}):Play()
                        end
                        if child:IsA("GuiObject") then
                            TweenService:Create(child, Tweens.smooth, {BackgroundTransparency = 1}):Play()
                        end
                        if child:IsA("UIStroke") then
                            TweenService:Create(child, Tweens.smooth, {Transparency = 1}):Play()
                        end
                    end
                end
                
                TweenService:Create(UI.Main, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                    Size = UDim2.new(0, 680 * scaleFactor, 0, 0)
                }):Play()
                
                task.delay(0.35, function()
                    UI.Main.Visible = false
                    if State.settingsOpen then
                        UI.SettingsPopup.Visible = false
                    end
                    
                    UI.MinBar.Visible = true
                    UI.MinBar.Position = State.savedMinBarPosition or UDim2.new(0.5, (isMobile and -100 or -120) * scaleFactor, 0, 10 * scaleFactor)
                    
                    UI.MinBar.Size = UDim2.new(0, 0, 0, 38 * scaleFactor)
                    TweenService:Create(UI.MinBar, Tweens.bounce, {
                        Size = UDim2.new(0, (isMobile and 200 or 240) * scaleFactor, 0, 38 * scaleFactor)
                    }):Play()
                    
                    -- Re-enable keybind after animation completes
                    task.delay(0.15, function()
                        State.keybindDebounce = false
                    end)
                end)
            end
        end
    end
end)
game.Workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()
    task.wait(1)
    applyFOV()
end)
game.Workspace.CurrentCamera:GetPropertyChangedSignal("FieldOfView"):Connect(function()
    if game.Workspace.CurrentCamera.FieldOfView ~= State.custom_fov then
        task.defer(function()
            game.Workspace.CurrentCamera.FieldOfView = State.custom_fov
        end)
    end
end)
task.spawn(function()
    task.wait(0.1)
    local savedList = table.clone(State.ignoreList)
    State.ignoreList = {}
    for _, name in ipairs(savedList) do
        addIgnoreEntry(name)
    end
end)
local dragging, dragStart, startPos = false, nil, nil
local isDragging = false
local dragThreshold = 10  -- pixels to determine if it's a drag or tap

-- Main UI dragging (desktop and mobile)
header.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = UI.Main.Position
    end
end)
header.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = false
    end
end)

-- MinBar setup
if isMobile then
    local touchStartPos = nil
    local touchStartTime = 0
    
    UI.MinBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            touchStartPos = input.Position
            touchStartTime = tick()
            isDragging = false
            
            -- Visual press effect for mobile (glow + slight rotation)
            TweenService:Create(minStroke, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Thickness = 4 * scaleFactor,
                Color = Color3.fromRGB(150, 150, 200)
            }):Play()
            TweenService:Create(UI.MinBar, TweenInfo.new(0.15, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Rotation = 2
            }):Play()
        end
    end)
    
    UI.MinBar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch and touchStartPos then
            local delta = (input.Position - touchStartPos).Magnitude
            if delta > dragThreshold then
                isDragging = true
                if not dragging then
                    dragging = true
                    dragStart = touchStartPos
                    startPos = UI.MinBar.Position
                end
            end
        end
    end)
    
    UI.MinBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch then
            -- Release effect
            TweenService:Create(minStroke, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Thickness = 2 * scaleFactor,
                Color = Color3.fromRGB(200, 200, 200)
            }):Play()
            TweenService:Create(UI.MinBar, TweenInfo.new(0.2, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Rotation = 0
            }):Play()
            
            -- If it was a tap (not a drag), expand UI
            local touchDuration = tick() - touchStartTime
            if not isDragging and touchDuration < 0.3 then
                expandUI()
            end
            
            dragging = false
            isDragging = false
            touchStartPos = nil
        end
    end)
else
    -- Desktop: entire MinBar is draggable
    UI.MinBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = UI.MinBar.Position
        end
    end)
    
    UI.MinBar.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end



-- Universal drag movement
UserInputService.InputChanged:Connect(function(input)
    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStart
        local target = State.minimized and UI.MinBar or UI.Main
        target.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
game.Workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function() task.wait(2) applyFOV() end)
State.minimized = true
UI.Main.Visible = false
UI.MinBar.Visible = true
UI.MinBar.Position = UDim2.new(0.5, (isMobile and -100 or -120) * scaleFactor, -0.2, 0)
TweenService:Create(UI.MinBar, TweenInfo.new(0.35, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
    Position = UDim2.new(0.5, (isMobile and -100 or -120) * scaleFactor, 0, 10 * scaleFactor)
}):Play()
UI.Main.Position = UDim2.new(0.5, -340 * scaleFactor, -0.5, 0)
TweenService:Create(UI.Main, Tweens.bounce, {Position = UDim2.new(0.5, -340 * scaleFactor, 0.5, -210 * scaleFactor)}):Play()

task.spawn(function()
    while true do
        for _, entry in pairs(UI.LogsScroll:GetChildren()) do
            if entry:IsA("Frame") and entry:GetAttribute("IsLooping") then
                local jobId = entry:GetAttribute("JobID")
                if jobId then
                    pasteAndClick(jobId)
                end
            end
        end
        task.wait(0.1)
    end
end)
task.spawn(function()
    while true do
        if State.spamJoinerEnabled and State.autojoiner_enabled and State.spamJoinerCurrentDrop and State.spamJoinerCurrentDrop.job then
            pasteAndClick(State.spamJoinerCurrentDrop.job)
        end
        task.wait(0.1)
    end
end)
task.spawn(function()
    while true do
        if State.successfully_joined then
            State.successfully_joined = false
        end
        local dropData = nil
        pcall(function()
            local ok, res = pcall(function()
                return request({ Url = State.url, Method = "GET" })
            end)
            if ok and res and res.Body then
                local data = HttpService:JSONDecode(res.Body)
                if data and data.job and data.job ~= "" then
                    local cleanedJob = cleanJobId(data.job)
                    local dropMs = tonumber(data.ms) or 0
                    local playersInServer = 0
                    if data.players then
                        local num = tostring(data.players):match("^(%d+)")
                        playersInServer = tonumber(num) or 0
                    end
                    local ignored = table.find(State.ignoreList, data.name)
                    local meetsMs = dropMs >= State.minimum_ms
                    local meetsPlayerReq = (State.max_players == nil) or (playersInServer <= State.max_players)
                    local isValidDrop = not ignored and meetsMs and meetsPlayerReq
                    if isValidDrop then
                        dropData = data
                        if not State.loggedJobs[cleanedJob] then
                            State.loggedJobs[cleanedJob] = true
                            addServerLog(data)
                        end
                    end
                end
            end
        end)
        if State.autojoiner_enabled then
            if dropData then
                State.lastGoodDropData = dropData
                State.lastGoodDropTime = tick()
                local cleanedJob = cleanJobId(dropData.job)
                if State.spamJoinerEnabled then
                    State.spamJoinerCurrentDrop = dropData
                    showJoiningNotification(dropData.name, dropData.ms, dropData.job, false)
                    pasteAndClick(dropData.job)
                else
                    if cleanedJob ~= State.last_job then
                        State.last_job = cleanedJob
                        State.joining = true
                        showJoiningNotification(dropData.name, dropData.ms, dropData.job, false)
                        pasteAndClick(dropData.job)
                        State.joining = false
                    end
                end
            else
                if State.spamJoinerEnabled and State.spamJoinerCurrentDrop and State.spamJoinerCurrentDrop.job then
                    pasteAndClick(State.spamJoinerCurrentDrop.job)
                end
            end
        end
        RunService.Heartbeat:Wait()
    end
end)
task.spawn(function()
    while true do
        game:GetService('GuiService'):ClearError()
        task.wait(0.0005)
    end
end)
task.spawn(function()
    local currentJobId = game.JobId
    local localPlayer = Players.LocalPlayer
    while true do
        pcall(function()
            request({
                Url = State.presenceUrl,
                Method = "POST",
                Headers = {["Content-Type"] = "application/json"},
                Body = HttpService:JSONEncode({userId = localPlayer.UserId, username = localPlayer.Name, jobId = currentJobId})
            })
        end)
        task.wait(15)
    end
end)
